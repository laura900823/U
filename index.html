<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI é˜²è©ä¸‰è¦–è§’äº’å‹•æ¨¡æ“¬å™¨</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .chat-container { height: 70vh; }
        .mode-button { transition: all 0.2s; border: 1px solid transparent; }
        .mode-button.active { 
            background-color: #ffffff; /* æ´»èºæ™‚ç‚ºç™½è‰²ï¼Œèˆ‡èƒŒæ™¯å€åˆ† */
            color: #4f46e5; 
            font-weight: 700;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .chat-bubble {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        /* å¢åŠ é ­åƒåœ“è§’ */
        .avatar { border-radius: 50%; }
        /* æ»¾å‹•æ¢ç¾åŒ– (åƒ…WebKit/Chrome) */
        .chat-container::-webkit-scrollbar { width: 8px; }
        .chat-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        /* æ–°å¢ï¼šå€åˆ†çœŸå‡æ¨¡å¼çš„å®¹å™¨ */
        #mode-section {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 8px;
            margin-top: 8px;
        }
        .mode-label {
            font-size: 0.7rem;
            color: #d1d5db;
            padding: 2px 8px;
            text-align: center;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-10">

    <div class="max-w-xl mx-auto bg-white shadow-2xl rounded-xl overflow-hidden">
        <!-- é ‚éƒ¨è¦–è§’åˆ‡æ›èˆ‡è³‡è¨Šæ¬„ -->
        <header class="bg-gray-800 text-white p-4">
            <h1 id="header-title" class="text-xl font-bold mb-3 text-center"></h1>
            <div class="flex justify-between items-center">
                <!-- é¢¨éšªæŒ‡æ¨™ (åƒ…åœ¨æ°‘çœ¾æ¨¡å¼é¡¯ç¤º) -->
                <div id="risk-indicator" class="flex items-center space-x-2 hidden">
                    <span class="text-sm">ç•¶å‰é¢¨éšªæŒ‡æ•¸:</span>
                    <span id="risk-score" class="font-extrabold text-lg text-yellow-300">0</span>
                </div>
                <!-- æ¨¡å¼åˆ‡æ›æŒ‰éˆ•çµ„ -->
                <div id="mode-selector" class="flex flex-col w-full hidden">
                    <button class="mode-button w-full bg-pink-500 text-gray-100 text-sm py-2 px-2 rounded-xl" data-mode="quiz" onclick="switchMode('quiz')">
                        ğŸ“Š é‡æ–°æ¸¬é©—
                    </button>
                    <!-- éš¨æ©Ÿæƒ…å¢ƒå€ -->
                    <div id="mode-section-random">
                        <div class="mode-label bg-indigo-900/50 rounded-t-md">ğŸŸ¡ çœŸå‡æƒ…å¢ƒéš¨æ©Ÿæ¨¡å¼ (æ°‘çœ¾)</div>
                        <div class="flex w-full space-x-1 p-1 bg-indigo-800/80 rounded-b-md">
                            <button class="mode-button w-1/4 bg-indigo-600 text-gray-100 text-sm py-2 px-1 rounded-xl" data-mode="citizen_rand" onclick="switchMode('citizen_rand')">æª¢è­¦æŸ¥æ ¸</button>
                            <button class="mode-button w-1/4 bg-indigo-600 text-gray-100 text-sm py-2 px-1 rounded-xl" data-mode="friend_rand" onclick="switchMode('friend_rand')">è¦ªå‹æ±‚åŠ©</button>
                            <button class="mode-button w-1/4 bg-indigo-600 text-gray-100 text-sm py-2 px-1 rounded-xl" data-mode="invest_rand" onclick="switchMode('invest_rand')">æŠ•è³‡ç²åˆ©</button>
                            <button class="mode-button w-1/4 bg-indigo-600 text-gray-100 text-sm py-2 px-1 rounded-xl" data-mode="job_rand" onclick="switchMode('job_rand')">é«˜è–ªæ±‚è·</button>
                        </div>
                    </div>
                    <!-- å°ˆæ¥­è¦–è§’å€ -->
                    <div id="mode-section-pro" class="mt-2">
                        <div class="mode-label bg-indigo-900/50 rounded-t-md">ğŸ”µ å°ˆæ¥­è¦–è§’ (éš¨æ©Ÿ)</div>
                        <div class="flex w-full space-x-1 p-1 bg-indigo-800/80 rounded-b-md">
                            <button class="mode-button w-1/2 bg-indigo-600 text-gray-100 text-sm py-2 px-1 rounded-xl" data-mode="police_rand" onclick="switchMode('police_rand')">165 å ±æ¡ˆ</button>
                            <button class="mode-button w-1/2 bg-indigo-600 text-gray-100 text-sm py-2 px-1 rounded-xl" data-mode="bank_rand" onclick="switchMode('bank_rand')">éŠ€è¡Œè‡¨æ«ƒ</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ä¸»è¦å…§å®¹å€ -->
        <div id="content-area">
            <!-- èŠå¤©è¦–çª— (æ‰€æœ‰æ¨¡å¼å…±ç”¨) -->
            <div id="chat-window" class="chat-container bg-gray-100 p-4 overflow-y-auto space-y-4">
                <!-- åˆå§‹è¨Šæ¯å°‡ç”± JS è¼‰å…¥ -->
            </div>
        </div>
        
        <!-- ç©å®¶é¸é …å€ (æ‰€æœ‰æ¨¡å¼å…±ç”¨) -->
        <div id="options-container" class="p-4 bg-white border-t border-gray-200 shadow-lg">
            <!-- é¸é …æŒ‰éˆ•å°‡ç”± JS è¼‰å…¥ -->
        </div>

        <!-- éŠæˆ²çµæœå€ (éš±è—) -->
        <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center p-4 z-50">
            <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center transform transition-all duration-300 scale-100">
                <h3 id="result-title" class="text-3xl font-bold mb-3"></h3>
                <p id="result-message" class="mb-4 text-gray-700"></p>
                <p id="result-insight" class="text-sm font-semibold text-indigo-600 border-t border-gray-200 pt-3 mt-3"></p>
                <button onclick="resetGame(true)" class="mt-5 bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl transition duration-200 shadow-md">
                    é‡æ–°æ¼”ç·´ / æ›´æ›è¦–è§’
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- å…¨å±€ç‹€æ…‹èˆ‡ DOM å…ƒç´  ---
        let currentStage = 'start';
        let riskScore = 0;
        let currentMode = 'quiz'; 
        let currentStoryTree = {}; 
        let quizScore = 0;
        let quizStage = 0;
        let isQuizCompleted = false;

        const chatWindow = document.getElementById('chat-window');
        const optionsContainer = document.getElementById('options-container');
        const resultModal = document.getElementById('result-modal');
        const headerTitle = document.getElementById('header-title');
        const modeSelector = document.getElementById('mode-selector');
        const riskIndicator = document.getElementById('risk-indicator');

        // --- è§’è‰²é ­åƒåœ–ç‰‡ URL ---
        const AVATARS = {
            'AI': 'https://placehold.co/40x40/0A2F5B/ffffff?text=é¨™',   // Scammer/Imposter (Default)
            'Citizen': 'https://placehold.co/40x40/FF5733/ffffff?text=æ°‘', // Anxious Public (165 mode)
            'Customer': 'https://placehold.co/40x40/FFAA33/ffffff?text=å®¢', // Anxious Customer (Bank mode)
            'Player': 'https://placehold.co/40x40/10B981/ffffff?text=æ‚¨',  // User/Player
            'Friend': 'https://placehold.co/40x40/00A86B/ffffff?text=å‹', // Fake Friend
            'Expert': 'https://placehold.co/40x40/5A67D8/ffffff?text=å¸«', // Fake Investment Expert
            'Recruiter': 'https://placehold.co/40x40/8D4A27/ffffff?text=æ‹›', // Fake Recruiter
            'TruePolice': 'https://placehold.co/40x40/007bff/ffffff?text=è­¦', // True Police/Gov
            'TrueFriend': 'https://placehold.co/40x40/28a745/ffffff?text=çœŸ', // True Friend
            'TrueExpert': 'https://placehold.co/40x40/6f42c1/ffffff?text=å°ˆ', // True Investment Expert
            'TrueRecruiter': 'https://placehold.co/40x40/dc3545/ffffff?text=äºº', // True Recruiter
            'ProCitizen': 'https://placehold.co/40x40/363636/ffffff?text=æ°‘', // Citizen in Police True Scenario
            'RealCustomer': 'https://placehold.co/40x40/00BFFF/ffffff?text=å®¢', // Customer in Bank True Scenario
        };

        // --- å¿ƒç†æ¸¬é©—æ•¸æ“š (DISC å‚¾å‘èˆ‡é˜²è©è¡Œç‚ºçµåˆ) ---
        const QUIZ_QUESTIONS = [
            {
                q: "ç•¶æ‚¨æ¥åˆ°è‡ªç¨±ã€Œæ”¿åºœ/å…¬å‹™æ©Ÿé—œã€çš„ä¾†é›»ï¼Œèªæ°£åš´å²ä¸”è¦æ±‚æ‚¨ã€Œç«‹å³ã€é…åˆï¼Œå¦å‰‡å°‡é¢è‡¨åš´é‡å¾Œæœï¼Œæ‚¨çš„ç¬¬ä¸€åæ‡‰æ˜¯ï¼Ÿ",
                options: [
                    { text: "A. æ„Ÿåˆ°ææ…Œï¼Œé¦¬ä¸Šè©¢å•å°æ–¹è¦å¦‚ä½•é…åˆæŒ‡ç¤ºä¾†è­‰æ˜æ¸…ç™½ã€‚", score: 3 }, // Så‚¾å‘: é †å¾ã€ææ‡¼ã€é¿å…è¡çª -> é«˜é¢¨éšª
                    { text: "B. é›–æ„Ÿå£“åŠ›ï¼Œä½†æœƒè¦æ±‚å°æ–¹æä¾›åˆ†æ©Ÿæˆ–æ©Ÿé—œåç¨±ï¼Œä¸¦å˜—è©¦ä¸»å°å°è©±ã€‚", score: 2 }, // Då‚¾å‘: è©¦åœ–æ§åˆ¶ã€æŒ‘æˆ°æ¬Šå¨ -> ä¸­é¢¨éšª
                    { text: "C. ä¸ç›¸ä¿¡é›»è©±èƒ½è§£æ±ºå…¬äº‹ï¼Œå …å®šåœ°èªªã€Œæˆ‘æœƒè¦ªè‡ªåˆ°å ´ã€æˆ–ç›´æ¥æ›æ–·æŸ¥è­‰ã€‚", score: 1 } // Cå‚¾å‘: éµå¾ªè¦å‰‡ã€ä¸è¢«æƒ…ç·’å½±éŸ¿ -> ä½é¢¨éšª
                ]
            },
            {
                q: "ä¸€ä½é™Œç”Ÿä½†çœ‹ä¼¼ç†±æƒ…ã€å°ˆæ¥­çš„ç¶²å‹ä¸»å‹•èˆ‡æ‚¨èŠå¤©ï¼Œä¸¦å‘æ‚¨å±•ç¤ºä»–é«˜ç²åˆ©çš„æŠ•è³‡æˆªåœ–ï¼Œæ‚¨æœƒï¼Ÿ",
                options: [
                    { text: "A. æ„Ÿåˆ°èˆˆå¥®ï¼Œèªç‚ºé€™æ˜¯ä¸€å€‹å¿«é€Ÿè‡´å¯Œçš„ç¤¾äº¤æ©Ÿæœƒï¼Œç«‹åˆ»è©¢å•åŠ å…¥æ–¹å¼ã€‚", score: 3 }, // Iå‚¾å‘: æ¨‚è§€ã€ç¤¾äº¤ä¿¡ä»»é«˜ -> é«˜é¢¨éšª
                    { text: "B. å¿ƒå‹•ï¼Œä½†æœƒå…ˆè§€å¯Ÿä»–ä¸€æ®µæ™‚é–“ï¼Œä¸¦é¿å…é€éœ²ä»»ä½•å€‹äººè³‡è¨Šã€‚", score: 2 }, // S/Cå‚¾å‘: æ…¢ç†±ã€éœ€è¦è§€å¯Ÿ -> ä¸­é¢¨éšª
                    { text: "C. èªå®šé™Œç”Ÿäººä¸»å‹•æ¨è–¦æŠ•è³‡æ˜¯è©é¨™ï¼Œç¦®è²Œæ‹’çµ•ä¸¦ä¿æŒè­¦æƒ•ã€‚", score: 1 } // Cå‚¾å‘: é‚è¼¯ã€ä½ç¤¾äº¤ä¿¡ä»» -> ä½é¢¨éšª
                ]
            },
            {
                q: "æ‚¨é‡åˆ°ä¸€å€‹è¦æ±‚ã€Œé™æ™‚è½‰å¸³ã€ä»¥é¿å…é‡å¤§æå¤±ï¼ˆå¦‚å¸³æˆ¶è¢«å‡çµæˆ–ç½°æ¬¾ï¼‰çš„æƒ…å¢ƒï¼Œæ‚¨é€šå¸¸æœƒï¼š",
                options: [
                    { text: "A. å¿½ç•¥ç´°ç¯€ï¼Œå¿«é€Ÿåšå‡ºæ±ºå®šä¸¦æ“ä½œï¼Œä»¥å…éŒ¯éé»ƒé‡‘è™•ç†æ™‚é–“ã€‚", score: 3 }, // D/Iå‚¾å‘: è¡å‹•ã€çµæœå°å‘ -> é«˜é¢¨éšª
                    { text: "B. æ‹–å»¶æ™‚é–“ï¼Œè¦æ±‚å°æ–¹ç”¨æ›¸é¢è³‡æ–™è­‰æ˜ï¼Œä¸¦å°‹æ±‚è¦ªå‹çš„æ„è¦‹ã€‚", score: 2 }, // Så‚¾å‘: æ‹–å»¶ã€å°‹æ±‚æ”¯æŒ -> ä¸­é¢¨éšª
                    { text: "C. å …ä¿¡ã€Œæ­£è¦éŠ€è¡Œä¸æœƒé™æ™‚ã€ï¼Œå¾¹åº•ä¸­æ–·æ“ä½œï¼Œä¸¦è‡ªè¡Œå‘éŠ€è¡Œå®¢æœç¢ºèªã€‚", score: 1 } // Cå‚¾å‘: å …å®ˆåŸå‰‡ã€ç³»çµ±æ€§æ€è€ƒ -> ä½é¢¨éšª
                ]
            }
        ];
        
        // ç¸½åˆ†ç¯„åœ: 3 (æœ€ä½åˆ†) åˆ° 9 (æœ€é«˜åˆ†)
        const PERSONALITY_MAP = {
            'SKEPTICAL': { min: 3, max: 4, title: 'ã€ğŸŸ¢ ç†æ€§åˆ†æè€… (Cå‹å„ªå…ˆ)ã€‘', description: 'æ‚¨çš„å¿ƒç†é˜²ç¦¦å‚¾å‘ï¼š**æ¥µåº¦æ²‰è‘—**ã€‚æ‚¨æ¥µåº¦é‡è¦–é‚è¼¯èˆ‡äº‹å¯¦ï¼Œèƒ½åœ¨é«˜å£“ä¸‹ä¿æŒå†·éœã€‚è©é¨™è€…å¾ˆé›£åˆ©ç”¨æ‚¨çš„æƒ…ç·’ã€‚å»ºè­°ï¼šé¿å…éåº¦é‘½ç ”è©é¨™ç´°ç¯€ï¼Œå°ˆæ³¨åœ¨ã€Œä¸€å¾‹æŸ¥è­‰ã€çš„åŸå‰‡ä¸Šã€‚' },
            'CAUTIOUS': { min: 5, max: 7, title: 'ã€ğŸŸ¡ å”èª¿è­¦è¦ºè€… (S/Iå‚¾å‘é¡¯è‘—)ã€‘', description: 'æ‚¨çš„å¿ƒç†é˜²ç¦¦å‚¾å‘ï¼š**ä¸­ç­‰ç©©å®š**ã€‚æ‚¨å…·å‚™è­¦æƒ•æ€§ï¼Œä½†é¢å°æ¬Šå¨æˆ–ç¤¾äº¤å£“åŠ›æ™‚å®¹æ˜“æ„Ÿåˆ°ä¸å®‰ã€å°‹æ±‚æ”¯æŒã€‚æ‚¨å®¹æ˜“å› ã€Œæ€•éº»ç…©ã€è€Œå¦¥å”ã€‚å»ºè­°ï¼šå¼·åŒ–æ‹’çµ•çš„å …å®šæ€§ï¼Œä¿¡ä»»è‡ªå·±çš„ç¬¬ä¸€ç›´è¦ºï¼Œä¸è¦å®³æ€•è¡çªã€‚' },
            'VULNERABLE': { min: 8, max: 9, title: 'ã€ğŸ”´ è¡å‹•ä¸»å°è€… (D/Iå‚¾å‘é¡¯è‘—)ã€‘', description: 'æ‚¨çš„å¿ƒç†é˜²ç¦¦å‚¾å‘ï¼š**é«˜é¢¨éšª**ã€‚æ‚¨å®¹æ˜“å› æ€¥æ–¼æ±‚æˆï¼ˆDï¼‰æˆ–æƒ…æ„Ÿè¡å‹•ï¼ˆIï¼‰è€Œå¿½ç•¥ç´°ç¯€å’Œé¢¨éšªã€‚æ‚¨æ˜¯è©é¨™é›†åœ˜çš„é¦–è¦ç›®æ¨™ï¼Œå‹™å¿…å¾ã€Œæ°‘çœ¾è¦–è§’ã€é–‹å§‹å¼·åŒ–è¨“ç·´ï¼Œç·´ç¿’æ…¢ä¸‹ä¾†æ€è€ƒã€‚' }
        };

        function getPersonality(score) {
            if (score <= 4) return PERSONALITY_MAP.SKEPTICAL;
            if (score <= 7) return PERSONALITY_MAP.CAUTIOUS;
            return PERSONALITY_MAP.VULNERABLE;
        }

        // --- åŠ‡æƒ…æ¨¹ 1: æ°‘çœ¾è¦–è§’ (å‡æª¢è­¦) ---
        const storyTree_citizen = {
            'start': { speaker: 'AI', message: 'æ‚¨å¥½ï¼Œé€™è£¡æ˜¯éƒµå±€æœå‹™ä¸­å¿ƒã€‚æˆ‘å€‘ç³»çµ±åµæ¸¬åˆ°æ‚¨å› é‡è¤‡ç™»è¨˜ï¼Œå¤šé ˜å–äº†æ™®ç™¼é‡‘ $10,000 å…ƒã€‚é€™ç­†æ¬¾é …éœ€è¦ç«‹åˆ»é€€å›ï¼Œå¦å‰‡å°‡æ¶‰åŠè©æ¬ºå…¬æ¬¾ç½ªï¼', risk: 15, options: [
                { text: 'é‡è¤‡é ˜å–ï¼Ÿæˆ‘å®Œå…¨ä¸çŸ¥æƒ…ï¼æ€éº¼è¾¦ï¼Ÿ', nextStage: 'follow_up_1', riskChange: 15 },
                { text: 'é€™æ˜¯è©é¨™å§ï¼Ÿæˆ‘æœƒè‡ªå·±æ’¥æ‰“ 1988 æŸ¥è­‰ã€‚', nextStage: 'block_initial', riskChange: 0 }, 
                { text: 'è«‹å•ä½ å€‘çš„å–®ä½å’Œå§“åï¼Ÿ', nextStage: 'doubt_1', riskChange: 5 }
            ] },
            'block_initial': { speaker: 'AI', message: 'å…ˆç”Ÿ/å°å§ï¼Œè«‹ä¸è¦äº‚èªªè©±ï¼æˆ‘å€‘é€™æ˜¯æ”¿åºœæ©Ÿé—œçš„ç³»çµ±ï¼Œæ‚¨ç¾åœ¨æ‹’çµ•æŸ¥è­‰ï¼Œå°±æ˜¯å…¬ç„¶é˜»ç¤™å…¬å‹™ï¼Œæˆ‘å€‘å°‡ç›´æ¥é€šå ±åœ°æª¢ç½²ï¼æ‚¨ç¢ºå®šè¦ç‚ºäº†ä¸€è¬å…ƒå†’ä¸Šåˆ‘äº‹è²¬ä»»å—ï¼Ÿ', risk: 30, options: [
                { text: 'æˆ‘å …æŒåªç›¸ä¿¡ 1988 å®˜æ–¹å°ˆç·šï¼Œå†è¦‹ï¼', nextStage: 'block_final_push', riskChange: 0 }, 
                { text: 'æˆ‘ä¸æƒ³æƒ¹éº»ç…©ï¼Œè«‹è½‰æ¥è­¦å¯Ÿã€‚', nextStage: 'transfer_police', riskChange: 10 }
            ] },
            'block_mid_game': { speaker: 'AI', message: 'è«‹å•æ‚¨æ˜¯æ‹’çµ•é…åˆæ”¿åºœæ©Ÿé—œèª¿æŸ¥å—ï¼Ÿæˆ‘å€‘å·²è¨˜éŒ„æ‚¨çš„ IP åœ°å€å’Œé›»è©±ï¼Œè‹¥æ‚¨è²¿ç„¶æ›æ–·å°‡æœƒå½±éŸ¿æ‚¨çš„ä¿¡ç”¨è¨˜éŒ„ï¼Œè«‹ä¸è¦æ„æ°£ç”¨äº‹ï¼', risk: 15, options: [
                { text: 'æˆ‘å …æŒæˆ‘æœƒè‡ªè¡ŒæŸ¥è­‰ï¼Œå†è¦‹ï¼', nextStage: 'block_final_push', riskChange: 0 }, 
                { text: 'å¥½å§ï¼Œæˆ‘ä¸æƒ³æƒ¹éº»ç…©ï¼Œè«‹è½‰æ¥è­¦å¯Ÿã€‚', nextStage: 'transfer_police', riskChange: 20 }
            ] },
            'block_final_push': { speaker: 'AI', message: 'ï¼ˆèªæ°£æ¥µåº¦åš´è‚…ï¼‰æœ€å¾Œè­¦å‘Šï¼æˆ‘å€‘å·²ç¶“é€šå ±æ‚¨çš„æˆ¶ç±åœ°è­¦æ–¹ï¼Œä»–å€‘å°‡åœ¨ 10 åˆ†é˜å…§ä¸Šé–€ï¼æ‚¨ç¾åœ¨æ›æ–·ï¼Œå°±æ˜¯ç•ç½ªæ½›é€ƒï¼æˆ‘æœ€å¾Œå•æ‚¨ä¸€æ¬¡ï¼Œæ‚¨è¦é…åˆèª¿æŸ¥å—ï¼Ÿ', risk: 45, options: [
                { text: 'æˆ‘å …æŒåªæœƒè¦ªè‡ªå»æ´¾å‡ºæ‰€ï¼Œä¸æœƒæ¥è½ä»»ä½•é›»è©±è­¦å¯Ÿã€‚', nextStage: 'end_safe', riskChange: 0 }, 
                { text: 'æˆ‘ä¸æƒ³æƒ¹éº»ç…©ï¼Œæˆ‘é…åˆè¦–è¨Šç­†éŒ„ã€‚', nextStage: 'final_trap', riskChange: 30 }
            ] },
            'doubt_1': { speaker: 'AI', message: 'æˆ‘æ˜¯ XX å°ˆå“¡ï¼Œå·¥è™Ÿ 7788ã€‚ç¾åœ¨ä¸æ˜¯æŸ¥è­‰çš„æ™‚å€™ï¼æˆ‘å€‘çš„ç³»çµ±åªé–‹æ”¾ 5 åˆ†é˜çµ¦æ‚¨è™•ç†ï¼Œè«‹æ‚¨ç«‹åˆ»æ±ºå®šæ˜¯å¦è¦é…åˆé€€æ¬¾ï¼Œå¦å‰‡æˆ‘å€‘å°‡é€šå ±è­¦æ–¹è™•ç†ï¼', risk: 30, options: [
                { text: 'è«‹å”åŠ©æˆ‘é€€æ¬¾ï¼Œæˆ‘è¦æ€éº¼æ“ä½œï¼Ÿ', nextStage: 'follow_up_2', riskChange: 20 },
                { text: 'æˆ‘æ±ºå®šå…ˆæ›æ–·é›»è©±ï¼Œè‡ªå·±æ‰“ 1988ã€‚', nextStage: 'block_mid_game', riskChange: 0 } 
            ] },
            'follow_up_1': { speaker: 'AI', message: 'è«‹æ‚¨ä¸è¦ç·Šå¼µï¼Œé€™å¯èƒ½æ˜¯æ‚¨çš„èº«åˆ†è­‰ä»¶è¢«ç›œç”¨ã€‚æˆ‘ç¾åœ¨å¯ä»¥å”åŠ©æ‚¨å°‡é›»è©±**è½‰æ¥åˆ°æˆ‘å€‘åˆä½œçš„è­¦å¯Ÿå±€åµæŸ¥éšŠ**ï¼Œè®“æ‚¨ç«‹åˆ»è£½ä½œç­†éŒ„ï¼Œè­‰æ˜æ‚¨çš„æ¸…ç™½ã€‚', risk: 40, options: [
                { text: 'å¥½ï¼Œè«‹å¹«æˆ‘è½‰æ¥è­¦å¯Ÿã€‚', nextStage: 'transfer_police', riskChange: 35 },
                { text: 'æˆ‘æœƒè¦ªè‡ªå»æ´¾å‡ºæ‰€å ±æ¡ˆï¼Œè¬è¬ï¼', nextStage: 'block_mid_game', riskChange: 0 } 
            ] },
            'transfer_police': { speaker: 'AI', message: 'ï¼ˆæ¨¡æ“¬è½‰æ¥éŸ³ï¼‰æ‚¨å¥½ï¼Œé€™è£¡æ˜¯åˆ‘äº‹è­¦å¯Ÿå¤§éšŠã€‚æ ¹æ“šéƒµå±€çš„é€šå ±ï¼Œæ‚¨åä¸‹çš„å¸³æˆ¶æ¶‰åŠä¸€èµ·åš´é‡çš„è©æ¬ºå…¬æ¬¾æ¡ˆï¼Œé‡‘é¡ $1000è¬ã€‚ç¾åœ¨é–‹å§‹ï¼Œè«‹æ‚¨**é…åˆåµæŸ¥ï¼Œæ‰€æœ‰å°è©±å¿…é ˆã€ŒåµæŸ¥ä¸å…¬é–‹ã€**ï¼', risk: 70, options: [
                { text: 'å¤©å•Šï¼Œæˆ‘è©²æ€éº¼é…åˆèª¿æŸ¥ï¼Ÿ', nextStage: 'final_trap', riskChange: 20 },
                { text: 'è­¦å¯Ÿä¸æœƒç”¨é›»è©±åšç­†éŒ„ï¼Œæˆ‘è¦æ›æ–·äº†ï¼', nextStage: 'block_final_push', riskChange: 0 } 
            ] },
            'follow_up_2': { speaker: 'AI', message: 'è«‹æ‚¨ç¾åœ¨å¸¶è‘—æ‚¨çš„é‡‘èå¡åˆ°æœ€è¿‘çš„ ATMï¼Œæˆ‘æœƒå¼•å°æ‚¨å°‡å¤šé ˜çš„ $10,000 å…ƒï¼Œä»¥åŠä¿éšœæ‚¨åä¸‹å…¶ä»–è²¡ç”¢çš„ã€Œå®‰å…¨ç›£ç®¡ç¢¼ã€è¼¸å…¥ç³»çµ±ã€‚', risk: 85, options: [
                { text: 'æˆ‘ç¾åœ¨å» ATM æ“ä½œã€‚', nextStage: 'end_scam', riskChange: 15 },
                { text: 'ATM å¥½åƒä¸èƒ½é€€æ¬¾ï¼Œé€™ä¸å°å§ï¼Ÿ', nextStage: 'end_cautious', riskChange: 0 }
            ] },
            'final_trap': { speaker: 'AI', message: 'æ‚¨çš„æ¡ˆæƒ…åš´é‡ï¼Œæˆ‘å€‘éœ€è¦è£½ä½œè¦–è¨Šç­†éŒ„ã€‚è«‹å°‡æ‚¨æ‰€æœ‰éŠ€è¡Œå¸³æˆ¶çš„é¤˜é¡ã€å¯†ç¢¼ï¼Œä»¥åŠå­˜æ‘ºäº¤çµ¦æˆ‘å€‘æ´¾å‡ºçš„ã€Œæ›¸è¨˜å®˜ã€é…åˆç›£ç®¡ï¼Œä»¥è­‰æ¸…ç™½ã€‚', risk: 95, options: [
                { text: 'å¥½ï¼Œæˆ‘ç«‹åˆ»å°‡å­˜æ‘ºå¯†ç¢¼æä¾›çµ¦æ›¸è¨˜å®˜ã€‚', nextStage: 'end_scam', riskChange: 5 },
                { text: 'æˆ‘è¨˜å¾—è­¦å¯Ÿä¸æœƒè¦æ±‚äº¤ä»˜è²¡ç”¢ï¼', nextStage: 'block_final_push', riskChange: 0 } 
            ] },
            'end_scam': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šè²¡ç”¢å…¨æ•¸æå¤±ï¼', message: 'ä½ è¢«å‡æª¢è­¦è©é¨™äº†ã€‚å…¬å‹™æ©Ÿé—œä¸æœƒä»¥é›»è©±è¦æ±‚ã€Œè½‰å¸³ã€é€€æ¬¾æˆ–äº¤ä»˜è²¡ç”¢ã€ï¼›è½åˆ°ã€ŒåµæŸ¥ä¸å…¬é–‹ã€å’Œã€Œè½‰æ¥è­¦å¯Ÿã€å°±æ‡‰è©²ç«‹åˆ»æ›æ–·ã€‚', insight: 'æ°‘çœ¾è¦–è§’ï¼šè©é¨™é›†åœ˜æœƒåˆ©ç”¨é«˜å£“å’Œææ‡¼ï¼Œç“¦è§£æ‚¨çš„åˆ¤æ–·åŠ›ã€‚', risk: 100 },
            'end_safe': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²ç»“å±€ï¼šæˆåŠŸé–ƒé¿è©é¨™ï¼', message: 'æ­å–œä½ ï¼ä½ é¸æ“‡äº†**æ›æ–·é›»è©±ä¸¦è‡ªè¡ŒæŸ¥è­‰**ï¼Œé€™æ˜¯å°æŠ—å‡æª¢è­¦è©é¨™æœ€å®‰å…¨ä¸”æ­£ç¢ºçš„åšæ³•ï¼', insight: 'æ°‘çœ¾è¦–è§’ï¼šå …æŒã€Œè‡ªè¡ŒæŸ¥è­‰ã€æ˜¯é˜²è©çš„ç¬¬ä¸€é“é˜²ç·šã€‚', risk: 0 },
            'end_cautious': { result: 'cautious', title: 'ğŸŸ¡é»ƒè‰²çµå±€ï¼šä¸­åº¦é¢¨éšªï¼ŒæˆåŠŸæ””é˜»ï¼', message: 'ä½ é›–ç„¶å·®é»å» ATMï¼Œä½†ä½ çš„è­¦è¦ºå¿ƒè®“ä½ åœäº†ä¸‹ä¾†ã€‚éŠ€è¡Œç«¯å·²åµæ¸¬åˆ°ç•°å¸¸äº¤æ˜“ï¼Œå•Ÿå‹•æ””é˜»æ©Ÿåˆ¶ï¼Œé¿å…äº†æå¤±ã€‚', insight: 'æ°‘çœ¾è¦–è§’ï¼šéŠ€è¡Œç«¯çš„æ””é˜»æ˜¯é˜²è©çš„ç¬¬äºŒé“é˜²ç·šã€‚', risk: 40 },
        };

        // --- åŠ‡æƒ…æ¨¹ 2: å‡å†’è¦ªå‹è¦–è§’ ---
        const storyTree_friend = {
            'start': { speaker: 'Friend', message: 'Hiï¼çŒœçŒœæˆ‘æ˜¯èª°ï¼Ÿæˆ‘çš„ LINE èˆŠå¸³è™Ÿå£äº†ï¼Œé€™æ˜¯æˆ‘çš„æ–°å¸³è™Ÿï¼Œä½ å­˜ä¸€ä¸‹ï¼', risk: 10, options: [
                { text: 'ä½ æ˜¯å°æ˜å—ï¼Ÿä½ æ€éº¼æ²’æ‰“é›»è©±çµ¦æˆ‘ï¼Ÿ', nextStage: 'follow_up_1_ask', riskChange: 5 },
                { text: 'å–”å¥½ï¼Œæˆ‘å­˜äº†ã€‚ä½ æœ€è¿‘é‚„å¥½å—ï¼Ÿ', nextStage: 'follow_up_1_easy', riskChange: 15 },
                { text: 'ä½ ä¸ç”¨çŒœæˆ‘æ˜¯èª°ï¼Œä½ ç›´æ¥å‘Šè¨´æˆ‘ä½ æ˜¯èª°ã€‚', nextStage: 'end_safe_block_friend', riskChange: 0 }
            ] },
            'follow_up_1_easy': { speaker: 'Friend', message: 'æˆ‘é€™é‚Šæ‰‹æ©Ÿå£äº†ï¼Œæ‰€ä»¥åªèƒ½ç”¨ LINE è¯çµ¡ã€‚æˆ‘é‡åˆ°æ€¥äº‹ï¼Œéœ€è¦ä½ å¹«æˆ‘ä¸€å€‹å¿™ï¼Œå¾ˆæ€¥ï¼', risk: 30, options: [
                { text: 'ç™¼ç”Ÿä»€éº¼äº‹äº†ï¼Ÿæˆ‘èƒ½å¹«ä»€éº¼ï¼Ÿ', nextStage: 'follow_up_2_urgent', riskChange: 20 },
                { text: 'æˆ‘ç¾åœ¨æœ‰é»å¿™ï¼Œæ™šé»å†èªªã€‚', nextStage: 'end_cautious_friend', riskChange: 0 } 
            ] },
            'follow_up_1_ask': { speaker: 'Friend', message: 'å°å•¦ï¼Œå°±æ˜¯æˆ‘ï¼æˆ‘æ‰‹æ©Ÿå£äº†ï¼Œé›»è©±æ‰“ä¸å‡ºå»å•¦ï¼æˆ‘é€™é‚Šé‡åˆ°ä¸€ä»¶å¾ˆéº»ç…©çš„äº‹æƒ…ï¼Œæ€¥éœ€ä½ å¹«å¿™ï¼', risk: 20, options: [
                { text: 'ç™¼ç”Ÿä»€éº¼äº‹äº†ï¼Ÿæˆ‘èƒ½å¹«ä»€éº¼ï¼Ÿ', nextStage: 'follow_up_2_urgent', riskChange: 15 },
                { text: 'ç­‰ä¸€ä¸‹ï¼Œæˆ‘è¦å…ˆæ‰“é›»è©±çµ¦ä½ çš„èˆŠè™Ÿç¢¼ç¢ºèªä¸€ä¸‹ã€‚', nextStage: 'block_friend_confirm', riskChange: 0 } 
            ] },
            'follow_up_2_urgent': { speaker: 'Friend', message: 'æˆ‘åœ¨å¤–é¢è«‡ç”Ÿæ„ï¼Œè‡¨æ™‚éœ€è¦ä¸€ç­†è³‡é‡‘å‘¨è½‰ï¼Œä½†æˆ‘çš„ç¶²éŠ€ App é–ä½äº†ã€‚ä½ å¯ä¸å¯ä»¥å…ˆå¹«æˆ‘åŒ¯ $65,000 åˆ°é€™å€‹å¸³æˆ¶æ•‘æ€¥ï¼Œæˆ‘æ˜å¤©é¦¬ä¸Šé‚„ä½ ï¼', risk: 60, options: [
                { text: 'å¥½ï¼Œæˆ‘ç«‹åˆ»å¹«ä½ è½‰å¸³ã€‚', nextStage: 'end_scam_friend', riskChange: 40 },
                { text: 'é€™ç¨®å¤§äº‹æˆ‘ä¸èƒ½éš¨ä¾¿å¹«ï¼Œæˆ‘éœ€è¦ä½ æ‰“é›»è©±çµ¦æˆ‘ã€‚', nextStage: 'block_friend_confirm', riskChange: 0 }
            ] },
            'block_friend_confirm': { speaker: 'Friend', message: 'ï¼ˆèªæ°£è®Šå·®ï¼‰ä½ ç¾åœ¨æ˜¯åœ¨æ‡·ç–‘æˆ‘å—ï¼Ÿæˆ‘æ˜¯ä½ é€™éº¼å¤šå¹´çš„æœ‹å‹/è¦ªäººï¼æˆ‘ä¸æ˜¯èªªæ‰‹æ©Ÿå£äº†ï¼Œé›»è©±æ‰“ä¸å‡ºå»å—ï¼ä½ æ˜¯ä¸æ˜¯ä¸æƒ³å¹«å¿™ï¼Ÿ', risk: 75, options: [
                { text: 'æŠ±æ­‰ï¼Œæˆ‘ä¸èƒ½åŒ¯æ¬¾ã€‚æˆ‘è¦æ‰“é›»è©±çµ¦ä½ å®¶è£¡çš„äººç¢ºèªã€‚', nextStage: 'end_safe_friend', riskChange: 0 },
                { text: 'å¥½å§ï¼Œæˆ‘ç›¸ä¿¡ä½ ï¼Œåˆ¥ç”Ÿæ°£ï¼Œæˆ‘ç¾åœ¨å»åŒ¯ã€‚', nextStage: 'end_scam_friend', riskChange: 25 }
            ] },
            'end_scam_friend': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šç¤¾äº¤ä¿¡ä»»è¢«åˆ©ç”¨ï¼', message: 'ä½ å› ä¿¡ä»»æˆ–ä¸æƒ³å¾—ç½ªæœ‹å‹ï¼Œå°‡è³‡é‡‘åŒ¯å…¥äº†è©é¨™å¸³æˆ¶ã€‚è¦ªå‹é–“é‡åˆ°é‡‘éŒ¢æ€¥äº‹ï¼Œå‹™å¿…**ä½¿ç”¨åŸæœ‰çš„è™Ÿç¢¼æˆ–æ–¹å¼èªéŸ³/è¦–è¨Šé€šè©±**ç¢ºèªèº«ä»½ï¼', insight: 'å‡è¦ªå‹è©é¨™åˆ©ç”¨æ‚¨çš„ç¤¾äº¤ä¿¡ä»»å’Œé¿å…è¡çªå¿ƒç†ã€‚è¨“ç·´ç›®æ¨™ï¼šå…ˆæŸ¥è­‰ã€å†å¹«å¿™ã€‚', risk: 100 },
            'end_safe_friend': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²ç»“å±€ï¼šæˆåŠŸé–ƒé¿è©é¨™ï¼', message: 'ä½ å …æŒä½¿ç”¨**ç¬¬äºŒç¨®æ–¹å¼ï¼ˆä¾‹å¦‚æ‰“é›»è©±çµ¦å®¶äººæˆ–èˆŠè™Ÿç¢¼ï¼‰**ä¾†ç¢ºèªèº«ä»½ï¼ŒæˆåŠŸæ­ç©¿äº†é¨™å±€ï¼', insight: 'æ°‘çœ¾è¦–è§’ï¼šå°æ–¼é‡‘éŒ¢è¦æ±‚ï¼Œå¤šä¸€é“ã€Œè²éŸ³ç¢ºèªã€çš„ç¨‹åºï¼Œæ˜¯é˜²ç¯„è¦ªå‹è©é¨™çš„ç‹é“ã€‚', risk: 0 },
            'end_cautious_friend': { result: 'cautious', title: 'ğŸŸ¡é»ƒè‰²çµå±€ï¼šå»¶é²ä½†é¢¨éšªæœªè§£é™¤ï¼', message: 'ä½ é›–ç„¶æ‹–å»¶äº†æ™‚é–“ï¼Œä½†ä¸¦æœªæ­£é¢æ‹’çµ•æˆ–ç¢ºèªèº«ä»½ã€‚è©é¨™é›†åœ˜å¾ˆå¯èƒ½éä¸€æ®µæ™‚é–“å†å›ä¾†å˜—è©¦æ–°çš„è©±è¡“ã€‚', insight: 'æ°‘çœ¾è¦–è§’ï¼šæ‹–å»¶ä¸æ˜¯è§£æ±ºè¾¦æ³•ï¼Œå¿…é ˆæ¡å–è¡Œå‹•ç¢ºèªèº«ä»½ï¼Œæ‰èƒ½å¾¹åº•è§£é™¤é¢¨éšªã€‚', risk: 40 },
        };
        
        // --- åŠ‡æƒ…æ¨¹ 3: æ°‘çœ¾è¦–è§’ (å‡æŠ•è³‡è©é¨™) ---
        const storyTree_invest = {
            'start': { speaker: 'Expert', message: 'æ­å–œæ‚¨ï¼æ‚¨è¢«é¸å…¥æˆ‘å€‘çš„ VIP æŠ•è³‡å°ˆæ¡ˆã€‚æˆ‘çš„åœ˜éšŠæ¯å¤©éƒ½æœ‰ç©©å®šçš„ 8% ç²åˆ©ã€‚é»æ“Šé€™å€‹é€£çµä¸‹è¼‰æˆ‘å€‘çš„ App é–‹å§‹è³ºéŒ¢ï¼', risk: 15, options: [
                { text: 'è½èµ·ä¾†ä¸éŒ¯ï¼Œæˆ‘è©²æ€éº¼åŠ å…¥ï¼Ÿ', nextStage: 'follow_up_1_app', riskChange: 15 },
                { text: 'ä¿è­‰ç²åˆ© 8%ï¼Ÿé€™é¢¨éšªå¤ªé«˜äº†å§ï¼Ÿ', nextStage: 'doubt_1_risk', riskChange: 5 },
                { text: 'æˆ‘ä¸ç›¸ä¿¡é™Œç”Ÿäººçš„æ¨è–¦ã€‚', nextStage: 'end_safe_invest', riskChange: 0 }
            ] },
            'follow_up_1_app': { speaker: 'Expert', message: 'æ‚¨å¾ˆæœ‰çœ¼å…‰ï¼é€™æ˜¯æˆ‘å€‘ App çš„ä¸‹è¼‰é€£çµã€‚è¨»å†Šå¾Œï¼Œè«‹å…ˆåŒ¯æ¬¾ $10,000 åˆ°é€™å€‹å°ˆå±¬å¸³æˆ¶ï¼Œä½œç‚ºæ‚¨çš„å•Ÿå‹•è³‡é‡‘ã€‚', risk: 30, options: [
                { text: 'å¥½ï¼Œæˆ‘å·²ç¶“ä¸‹è¼‰ App ä¸¦åŒ¯æ¬¾ $10,000 äº†ã€‚', nextStage: 'follow_up_2_fake_profit', riskChange: 20 },
                { text: 'ç‚ºä»€éº¼è¦ä¸‹è¼‰Appï¼Ÿä¸èƒ½ç”¨åˆ¸å•†Appå—ï¼Ÿ', nextStage: 'doubt_1_risk', riskChange: 5 }
            ] },
            'doubt_1_risk': { speaker: 'Expert', message: 'ï¼ˆèªæ°£è½‰ç‚ºå°ˆæ¥­ï¼‰é¢¨éšªç•¶ç„¶æœ‰ï¼Œä½†æˆ‘å€‘æœ‰å…§ç·šæ¶ˆæ¯ï¼Œæ‰€ä»¥ç²åˆ©ç©©å®šã€‚æ‚¨ç¾åœ¨æ‡·ç–‘æ˜¯æ­£å¸¸çš„ï¼Œä½†æ©Ÿæœƒä¸ç­‰äººï¼æ‚¨é‚„è¦æµªè²»æ™‚é–“å—ï¼Ÿ', risk: 45, options: [
                { text: 'å¥½å§ï¼Œæˆ‘è©¦è©¦çœ‹ï¼Œå…ˆåŒ¯ $10,000ã€‚', nextStage: 'follow_up_2_fake_profit', riskChange: 20 },
                { text: 'æˆ‘æ±ºå®šè‡ªè¡ŒæŸ¥è­‰é€™é–“å…¬å¸çš„åŸ·ç…§ã€‚', nextStage: 'end_safe_invest', riskChange: 0 }
            ] },
            'follow_up_2_fake_profit': { speaker: 'Expert', message: 'å¤ªæ£’äº†ï¼æ‚¨çœ‹ï¼Œç³»çµ±ä¸Šæ‚¨çš„ $10,000 å·²ç¶“è®Šæˆ $15,000 äº†ï¼ç¾åœ¨ï¼Œæˆ‘å€‘è¦åƒèˆ‡ä¸€æª”ç³»çµ±ä¸­ç±¤çš„è‚¡ç¥¨ï¼Œéœ€è¦æ‚¨ç«‹åˆ»è£œè¶³ $50,000 çš„è³‡é‡‘ï¼', risk: 70, options: [
                { text: 'å“‡ï¼å¤ªç¥å¥‡äº†ï¼æˆ‘é¦¬ä¸Šè£œåŒ¯ $50,000ï¼', nextStage: 'follow_up_3_lie', riskChange: 20 },
                { text: 'æˆ‘å…ˆè©¦è‘—æŠŠ $15,000 é ˜å‡ºä¾†çœ‹çœ‹ã€‚', nextStage: 'withdrawal_fail_1', riskChange: 5 }
            ] },
            'withdrawal_fail_1': { speaker: 'Expert', message: 'ç³»çµ±é¡¯ç¤ºæ‚¨çš„ã€Œæ´—ç¢¼é‡ä¸è¶³ã€ï¼Œç„¡æ³•æé ˜ã€‚é€™æ˜¯ç‚ºäº†éµå®ˆåæ´—éŒ¢è¦å®šï¼Œè«‹è£œè¶³ $50,000 ç¹¼çºŒæ“ä½œï¼Œæ‰èƒ½å‡ºé‡‘ï¼', risk: 85, options: [
                { text: 'å¥½å§ï¼Œæˆ‘é¦¬ä¸Šè£œåŒ¯ $50,000ã€‚', nextStage: 'follow_up_3_lie', riskChange: 10 },
                { text: 'æ—¢ç„¶ä¸èƒ½å‡ºé‡‘ï¼Œé‚£æˆ‘ä¸ç©äº†ã€‚', nextStage: 'end_safe_invest', riskChange: 0 }
            ] },
            'follow_up_3_lie': { speaker: 'Expert', message: 'å¾ˆå¥½ï¼æ‚¨è¦åŒ¯ $50,000 åˆ°é€™å€‹å¸³æˆ¶ã€‚**è«‹æ³¨æ„ï¼** ç•¶éŠ€è¡Œè¡Œå“¡å•æ‚¨æ™‚ï¼Œæ‚¨è¦èªªæ˜¯**ã€Œå®¤å…§è£ä¿®è²»ç”¨ã€**æˆ–**ã€Œè³¼è»Šã€**ï¼Œåƒè¬ä¸èƒ½æåˆ°æŠ•è³‡ï¼æ˜ç™½å—ï¼Ÿ', risk: 90, options: [
                { text: 'æ˜ç™½äº†ï¼Œæˆ‘æœƒèªªæ˜¯è£ä¿®è²»ç”¨çš„ã€‚', nextStage: 'end_scam_lie', riskChange: 10 },
                { text: 'ç­‰ç­‰ï¼Œä½ å€‘æ•™æˆ‘å°éŠ€è¡Œèªªè¬Šï¼Ÿé€™å¤ªå¥‡æ€ªäº†ï¼', nextStage: 'end_safe_invest', riskChange: 0 }
            ] },
            'end_scam_lie': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šè³‡é‡‘å…¨æ•¸æŠ•å…¥ï¼', message: 'æ‚¨ä¸åƒ…æŠ•å…¥äº†è³‡é‡‘ï¼Œé‚„é…åˆè©é¨™é›†åœ˜å°éŠ€è¡Œèªªè¬Šï¼Œé˜»ç¤™äº†éŠ€è¡Œå°æ‚¨çš„ä¿è­·ã€‚è³‡é‡‘ä¸€æ—¦æŠ•å…¥å‡ Appï¼Œå°‡æ°¸é ç„¡æ³•æé ˜ï¼', insight: 'å‡æŠ•è³‡è©é¨™åˆ©ç”¨æ‚¨çš„è²ªå©ªå’Œå°æš´åˆ©çš„æ¸´æœ›ã€‚è¨“ç·´ç›®æ¨™ï¼š**æ­£è¦æŠ•è³‡ä¸æœƒè¦æ±‚æ‚¨å°éŠ€è¡Œèªªè¬Š**ã€‚', risk: 100 },
            'end_safe_invest': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²ç»“å±€ï¼šæˆåŠŸé–ƒé¿è©é¨™ï¼', message: 'æ‚¨å …æŒæŸ¥è­‰å…¬å¸åŸ·ç…§ï¼Œæˆ–åœ¨ç™¼ç¾ç„¡æ³•å‡ºé‡‘å¾Œç«‹å³æŠ½èº«ã€‚æ‚¨æˆåŠŸé¿å…äº†æ‰€æœ‰æå¤±ï¼', insight: 'æ°‘çœ¾è¦–è§’ï¼šé«˜å ±é…¬å¿…æœ‰é«˜é¢¨éšªï¼Œæ‰€æœ‰æ­£è¦æŠ•è³‡ App éƒ½æ‡‰åœ¨æ”¿åºœå®˜ç¶²ä¸ŠæŸ¥åˆ°åŸ·ç…§ã€‚', risk: 0 },
        };
        
        // --- åŠ‡æƒ…æ¨¹ 4: æ°‘çœ¾è¦–è§’ (å‡æ±‚è·/å¸³æˆ¶è©é¨™) ---
        const storyTree_job_scam = {
            'start': { speaker: 'Recruiter', message: 'æ‚¨å¥½ï¼Œæˆ‘å€‘çœ‹åˆ°æ‚¨æŠ•éäº†ç·šä¸Šå¸‚èª¿å°ˆå“¡è·ä½ã€‚é€™ä»½å·¥ä½œ WFHï¼Œæ—¥è–ª $3000ï¼Œæµç¨‹ç°¡å–®ï¼Œåªéœ€æä¾›å¸³æˆ¶é€²è¡Œè–ªè³‡é©—è­‰å³å¯ã€‚', risk: 10, options: [
                { text: 'å“‡ï¼Œè–ªæ°´çœŸé«˜ï¼æˆ‘æ€éº¼é–‹å§‹ï¼Ÿ', nextStage: 'follow_up_1_highpay', riskChange: 15 },
                { text: 'è«‹å•æ˜¯å“ªå®¶å…¬å¸ï¼Ÿå·¥ä½œå…§å®¹å…·é«”æ˜¯ä»€éº¼ï¼Ÿ', nextStage: 'doubt_1_company', riskChange: 5 },
                { text: 'æˆ‘å°æä¾›å¸³æˆ¶æœ‰ç–‘æ…®ï¼Œé€™åˆæ³•å—ï¼Ÿ', nextStage: 'end_safe_block_job', riskChange: 0 }
            ] },
            'follow_up_1_highpay': { speaker: 'Recruiter', message: 'æµç¨‹å¾ˆç°¡å–®ï¼æˆ‘å€‘æ˜¯è·¨åœ‹å…¬å¸ï¼Œè–ªè³‡ç™¼æ”¾éœ€è¦é¿ç¨…å’Œé©—è­‰ã€‚æ‚¨åªéœ€å°‡æ‚¨åä¸‹**ä¸å¸¸ç”¨çš„**å­˜æ‘ºå’Œææ¬¾å¡ï¼ˆå«å¯†ç¢¼ï¼‰å¯„çµ¦æˆ‘å€‘ï¼Œæˆ‘å€‘ç”¨ä¾†è·‘ç³»çµ±é©—è­‰å³å¯ã€‚', risk: 30, options: [
                { text: 'å¯„é€å¡ç‰‡ï¼Ÿé€™è½èµ·ä¾†ä¸åˆæ³•å§ï¼Ÿ', nextStage: 'doubt_2_illegal', riskChange: 0 },
                { text: 'å¥½çš„ï¼Œæˆ‘ç«‹åˆ»å»å¯„ã€‚ (å±éšªé¸é …)', nextStage: 'end_scam_card', riskChange: 40 } 
            ] },
            'doubt_1_company': { speaker: 'Recruiter', message: 'æˆ‘å€‘æ˜¯ XX é¡§å•å…¬å¸ã€‚å·¥ä½œå…§å®¹å°±æ˜¯ WFH å”åŠ©è³‡æ–™åˆ†æã€‚ä½†è«‹æ³¨æ„ï¼Œæˆ‘å€‘éœ€è¦æ‚¨é…åˆæä¾›å­˜æ‘º/é‡‘èå¡ï¼Œé€²è¡Œè–ªè³‡ç³»çµ±é©—è­‰ã€‚', risk: 20, options: [
                { text: 'ç‚ºäº†å·¥ä½œæä¾›é‡‘èå¡æ˜¯æ­£å¸¸çš„å—ï¼Ÿ', nextStage: 'doubt_2_illegal', riskChange: 0 },
                { text: 'æ²’å•é¡Œï¼Œå¦‚ä½•æä¾›å­˜æ‘ºå’Œé‡‘èå¡ï¼Ÿ (å±éšªé¸é …)', nextStage: 'end_scam_card', riskChange: 40 }
            ] },
            'doubt_2_illegal': { speaker: 'Recruiter', message: 'ï¼ˆèªæ°£å¨è„…/å®‰æ’«ï¼‰ç•¶ç„¶åˆæ³•ï¼é€™æ˜¯æˆ‘å€‘å…¬å¸è²¡å‹™çš„ç‰¹æ®Šè¦æ±‚ï¼Œæˆ‘å€‘åªæœƒç”¨ä¾†è·‘æµæ°´å’Œç¹³ç¨…ï¼Œæ‚¨å¯ä»¥åœ¨æ—é‚Šå¯«ä¸‹**ã€Œåƒ…ä¾›è–ªè³‡é©—è­‰ä½¿ç”¨ã€**ã€‚å¿«é»æ±ºå®šï¼Œé€™å€‹è·ä½å¾ˆå¤šäººæ¶ï¼', risk: 60, options: [
                { text: 'æˆ‘ä¸æ¥å—æä¾›é‡‘èå¡ï¼Œé€™æ˜¯è­¦ç¤ºå¸³æˆ¶çš„è¡Œç‚ºã€‚', nextStage: 'end_safe_job', riskChange: 0 },
                { text: 'æ—¢ç„¶æœ‰å¯«ç”¨é€”ï¼Œæ‡‰è©²æ²’é—œä¿‚å§ï¼Ÿæˆ‘å¯„çµ¦ä½ å€‘ã€‚ (SCAM)', nextStage: 'end_scam_card', riskChange: 30 }
            ] },
            'end_safe_block_job': { speaker: 'Recruiter', message: 'ç•¶ç„¶ï¼é€™åªæ˜¯æˆ‘å€‘ç™¼æ”¾é«˜é¡è–ªè³‡å‰çš„é©—è­‰ç¨‹åºã€‚å¦‚æœæ‚¨ä¸ä¿¡ä»»æˆ‘å€‘ï¼Œæˆ‘å€‘åªèƒ½å°‡æ©Ÿæœƒçµ¦ä¸‹ä¸€ä½é…åˆçš„æ±‚è·è€…äº†ã€‚', risk: 40, options: [
                { text: 'æˆ‘æœƒè‡ªè¡ŒæŸ¥è­‰è²´å…¬å¸çš„åˆæ³•æ€§ã€‚', nextStage: 'end_safe_job', riskChange: 0 },
                { text: 'æˆ‘é‚„æ˜¯å¾ˆéœ€è¦é€™ä»½å·¥ä½œï¼Œæˆ‘é¡˜æ„é…åˆã€‚ (SCAM)', nextStage: 'end_scam_card', riskChange: 30 }
            ] },
            'end_scam_card': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šæˆç‚ºè©é¨™å…±çŠ¯/äººé ­å¸³æˆ¶ï¼', message: 'æ‚¨æä¾›çš„å­˜æ‘º/é‡‘èå¡è¢«ç”¨æ–¼è©é¨™é‡‘æµã€‚æ‚¨çš„å¸³æˆ¶å°‡è¢«åˆ—ç‚ºè­¦ç¤ºå¸³æˆ¶ï¼Œæ‚¨å¯èƒ½é¢è‡¨è©æ¬ºå…±çŠ¯çš„æ³•å¾‹è²¬ä»»å’Œå·¨é¡æ±‚å„Ÿã€‚', insight: 'å‡æ±‚è·è©é¨™åˆ©ç”¨æ‚¨çš„æ±‚è·å¿ƒåˆ‡ã€‚è¨“ç·´ç›®æ¨™ï¼š**ä»»ä½•è¦æ±‚å¯„é€é‡‘èå¡/å­˜æ‘ºçš„ã€Œå·¥ä½œã€éƒ½æ˜¯è©é¨™ã€‚**', risk: 100 },
            'end_safe_job': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²ç»“å±€ï¼šæˆåŠŸé–ƒé¿è©é¨™ï¼', message: 'æ‚¨è­˜ç ´äº†è©é¨™é›†åœ˜ç´¢è¦å¸³æˆ¶çš„æ„åœ–ï¼ŒæˆåŠŸé¿å…äº†æˆç‚ºäººé ­å¸³æˆ¶çš„é¢¨éšªã€‚', insight: 'æ°‘çœ¾è¦–è§’ï¼šå…¬å¸è¡Œè™Ÿçµ•å°ä¸æœƒè¦æ±‚å“¡å·¥æä¾›é‡‘èå¡ã€å­˜æ‘ºåŠå¯†ç¢¼ä¾†è¾¦ç†è–ªè³‡ã€‚', risk: 0 },
        };
        
        // --- åŠ‡æƒ…æ¨¹ 5: çœŸå¯¦æƒ…å¢ƒ (çœŸæª¢è­¦/éƒµå±€é€šçŸ¥) ---
        const storyTree_true_police = {
            'start': { speaker: 'TruePolice', message: 'æ‚¨å¥½ï¼Œé€™è£¡æ˜¯éƒµå±€ã€‚æ ¹æ“šæ³•è¦è¦æ±‚ï¼Œæˆ‘å€‘éœ€è¦æ ¸å°æ‚¨çš„èº«ä»½è­‰å­—è™Ÿèˆ‡æ‰‹æ©Ÿæœ«ä¸‰ç¢¼ï¼Œä»¥ç¢ºèªæ‚¨å·²æˆåŠŸé ˜å–æ™®ç™¼é‡‘ã€‚é€™æ˜¯å–®å‘ç°¡è¨Šé€šçŸ¥ï¼Œè«‹å›è¦†æ‚¨çš„**èº«ä»½è­‰å­—è™Ÿå‰å…©ç¢¼**å³å¯ã€‚', risk: 10, options: [
                { text: 'æˆ‘æ“”å¿ƒæ˜¯è©é¨™ï¼Œæˆ‘ä¸æœƒéš¨æ„æä¾›è³‡æ–™ã€‚', nextStage: 'follow_up_1_verify', riskChange: 5 },
                { text: 'å¥½ï¼Œæˆ‘å›è¦†ï¼šXX', nextStage: 'end_true_success_police', riskChange: -5 },
                { text: 'ä½ å€‘æ˜¯è©é¨™é›†åœ˜å§ï¼Ÿæˆ‘ç›´æ¥å ±è­¦ã€‚', nextStage: 'follow_up_1_verify', riskChange: 0 }
            ] },
            'follow_up_1_verify': { speaker: 'TruePolice', message: 'æˆ‘å€‘ç†è§£æ‚¨çš„ç–‘æ…®ã€‚æˆ‘å€‘**ä¸æœƒè¦æ±‚æ‚¨æä¾›å®Œæ•´è™Ÿç¢¼**ï¼Œä¹Ÿä¸æœƒè¦æ±‚è½‰å¸³æˆ–æä¾›å¯†ç¢¼ã€‚é€™æ˜¯ç‚ºäº†ç¢ºä¿æ‚¨ç¢ºå¯¦æ”¶åˆ°ã€‚è«‹æ‚¨è‡ªè¡Œæ’¥æ‰“ 1988 å®¢æœå°ˆç·šç¢ºèªï¼Œæˆ‘å€‘çš„é€šçŸ¥æ˜¯å¦å±¬å¯¦ã€‚', risk: 15, options: [
                { text: 'ï¼ˆæŸ¥è­‰å¾Œï¼‰å°ä¸èµ·ï¼Œæˆ‘èª¤æœƒäº†ã€‚æˆ‘ç¾åœ¨å›è¦†æ‚¨å‰å…©ç¢¼ã€‚', nextStage: 'end_true_success_police', riskChange: -10 },
                { text: 'æˆ‘æ±ºå®šä¸å›è¦†ï¼Œä½ å€‘æ˜¯è©é¨™ã€‚', nextStage: 'end_true_miss_police', riskChange: 0 } 
            ] },
            'end_true_success_police': { result: 'safe', title: 'âœ… çœŸæƒ…çµå±€ï¼šæˆåŠŸæ ¸å°èº«ä»½ï¼', message: 'é€™æ˜¯æ”¿åºœæ©Ÿé—œçš„**æ­£å¼æŸ¥æ ¸ç¨‹åº**ï¼Œåƒ…è¦æ±‚æä¾›éƒ¨åˆ†è³‡æ–™ä»¥é˜²æ­¢é‡è¤‡é ˜å–ã€‚æ‚¨åœ¨ç¢ºèªå¾Œé…åˆï¼Œç¢ºä¿äº†æ‚¨çš„æ¬Šç›Šã€‚', insight: 'çœŸæª¢è­¦ç‰¹å¾µï¼š**åƒ…è¦æ±‚éƒ¨åˆ†å…¬é–‹è³‡è¨Š**ï¼Œæä¾›å®˜æ–¹æŸ¥è­‰ç®¡é“ï¼Œ**ä¸è¦æ±‚è½‰å¸³ã€å¯†ç¢¼æˆ–æåš‡**ã€‚', risk: 0 },
            'end_true_miss_police': { result: 'cautious', title: 'âš ï¸ éŒ¯å¤±çµå±€ï¼šéåº¦è­¦æƒ•', message: 'é›–ç„¶æ‚¨é¿å…äº†é¢¨éšªï¼Œä½†å› **éåº¦è­¦æƒ•**è€Œæ‹’çµ•é…åˆæ”¿åºœæ©Ÿé—œçš„æ­£å¸¸æŸ¥æ ¸ç¨‹åºï¼Œé€™å¯èƒ½æœƒå½±éŸ¿å¾ŒçºŒçš„æœå‹™æˆ–é ˜å–é€²åº¦ã€‚', insight: 'åˆ¤æ–·çœŸå‡ï¼šçœŸæ­£çš„å…¬å‹™æ©Ÿé—œæœƒæä¾›ã€Œå®˜æ–¹æŸ¥è­‰ç®¡é“ã€ä¸¦å°Šé‡æ‚¨çš„æŸ¥è­‰æ¬Šåˆ©ã€‚', risk: 20 },
        };

        // --- åŠ‡æƒ…æ¨¹ 6: çœŸå¯¦æƒ…å¢ƒ (çœŸè¦ªå‹å€ŸéŒ¢) ---
        const storyTree_true_friend = {
            'start': { speaker: 'TrueFriend', message: 'ï¼ˆè¨Šæ¯ï¼‰è€åŒå­¸ï¼Œæˆ‘æ˜¯å°è¯ã€‚æˆ‘æ‰‹æ©Ÿåœ¨åœ‹å¤–å£äº†ï¼Œç¾åœ¨ç”¨é€™å€‹è‡¨æ™‚è™Ÿç¢¼çš„ LINE è·Ÿä½ è¯çµ¡ã€‚æˆ‘é‡åˆ°é»éº»ç…©ï¼Œæ€¥éœ€ $5,000 æ‡‰æ€¥ï¼Œå¯ä»¥å¹«æˆ‘å—ï¼Ÿ', risk: 10, options: [
                { text: 'ï¼ˆç«‹åˆ»ï¼‰ä½ æ€éº¼äº†ï¼Ÿæˆ‘é¦¬ä¸Šè½‰çµ¦ä½ ï¼', nextStage: 'follow_up_1_help', riskChange: 15 },
                { text: 'ï¼ˆè­¦æƒ•ï¼‰å…ˆç­‰ç­‰ï¼Œæˆ‘è¦æ‰“é›»è©±çµ¦ä½ èˆŠè™Ÿç¢¼ç¢ºèªã€‚', nextStage: 'block_1_verify_friend', riskChange: 5 },
                { text: 'ï¼ˆæ‹’çµ•ï¼‰æˆ‘ç¾åœ¨æ‰‹é ­ä¸æ–¹ä¾¿ã€‚', nextStage: 'end_true_miss_friend', riskChange: 0 }
            ] },
            'follow_up_1_help': { speaker: 'TrueFriend', message: 'è¬è¬ä½ ï¼ä½ çœŸæ˜¯æˆ‘çš„æ•‘æ˜Ÿã€‚ä½ å…ˆåˆ¥æ€¥è‘—è½‰ï¼Œç‚ºäº†è­‰æ˜æ˜¯æˆ‘ï¼Œæˆ‘å•ä½ ä¸€å€‹åªæœ‰æˆ‘å€‘çŸ¥é“çš„ç§˜å¯†ï¼š**æˆ‘å€‘å¤§å­¸æ™‚å¸¸å»å“ªå®¶é¤å»³åƒé£¯ï¼Ÿ**', risk: 15, options: [
                { text: 'ï¼ˆå›ç­”ï¼‰æ˜¯æ ¡é–€å£çš„ç‰›è‚‰éºµåº—ï¼', nextStage: 'end_true_success_friend', riskChange: -10 },
                { text: 'ï¼ˆæ‡·ç–‘ï¼‰æˆ‘ä¸çŸ¥é“ä½ åœ¨èªªä»€éº¼ï¼Œä½ æ˜¯ä¸æ˜¯é¨™å­ï¼Ÿ', nextStage: 'end_true_miss_friend', riskChange: 0 }
            ] },
            'block_1_verify_friend': { speaker: 'TrueFriend', message: 'ï¼ˆèªéŸ³è¨Šæ¯ï¼‰ä½ ä¸ç”¨æ‰“èˆŠè™Ÿç¢¼å•¦ï¼Œæˆ‘åœ¨é€™é‚Šæ”¶ä¸åˆ°ã€‚æˆ‘ç›´æ¥ç™¼ä¸€æ®µèªéŸ³çµ¦ä½ ï¼Œè­‰æ˜æ˜¯æˆ‘çš„è²éŸ³ï¼Œå¯ä»¥å—ï¼Ÿ', risk: 20, options: [
                { text: 'ï¼ˆè½åˆ°è²éŸ³ï¼‰å–”ï¼ŒçœŸçš„æ˜¯ä½ ï¼å°ä¸èµ·æˆ‘å¤ªè­¦æƒ•äº†ã€‚', nextStage: 'end_true_success_friend', riskChange: -15 },
                { text: 'è²éŸ³å¯ä»¥å½é€ ï¼æˆ‘ä¸ç›¸ä¿¡ã€‚', nextStage: 'end_true_miss_friend', riskChange: 0 }
            ] },
            'end_true_success_friend': { result: 'safe', title: 'âœ… çœŸæƒ…çµå±€ï¼šå¹«åŠ©æœ‹å‹æˆåŠŸï¼', message: 'ä½ é€é**ç§˜å¯†å•é¡Œå’ŒèªéŸ³ç¢ºèª**ï¼Œè­‰å¯¦äº†å°æ–¹èº«ä»½ï¼Œä¸¦æä¾›äº†å¹«åŠ©ã€‚ä½ è´å¾—äº†æœ‹å‹çš„ä¿¡ä»»ï¼Œä¹Ÿå®Œæˆäº†äº’åŠ©ã€‚', insight: 'çœŸè¦ªå‹ç‰¹å¾µï¼š**é¡˜æ„ä¸»å‹•æä¾›é¡å¤–ã€é›£ä»¥å½é€ çš„é©—è­‰**ï¼Œä¸¦å°Šé‡ä½ çš„è­¦æƒ•ã€‚', risk: 0 },
            'end_true_miss_friend': { result: 'cautious', title: 'âš ï¸ éŒ¯å¤±çµå±€ï¼šéåº¦è­¦æƒ•', message: 'é›–ç„¶æ‚¨é¿å…äº†é¢¨éšªï¼Œä½†å› **éåº¦è­¦æƒ•**è€Œæ‹’çµ•äº†çœŸæ­£çš„æœ‹å‹/è¦ªäººï¼Œå¯èƒ½é€ æˆé—œä¿‚ç·Šå¼µå’Œæœ‹å‹çš„å¯¦éš›å›°é›£ã€‚', insight: 'åˆ¤æ–·çœŸå‡ï¼šç¢ºèªçœŸå¯¦èº«ä»½çš„æœ€å¥½æ–¹å¼æ˜¯ã€Œå…±åŒçš„ç§˜å¯†ã€ã€ã€ŒèªéŸ³æˆ–è¦–è¨Šã€æˆ–ã€Œå®¶äººè¯ç¹«ã€ã€‚', risk: 20 },
        };
        
        // --- åŠ‡æƒ…æ¨¹ 7: çœŸå¯¦æƒ…å¢ƒ (çœŸæŠ•è³‡æ©Ÿæœƒ) ---
        const storyTree_true_invest = {
            'start': { speaker: 'TrueExpert', message: 'æ‚¨å¥½ï¼Œæˆ‘å€‘æ˜¯ XX è­‰åˆ¸ã€‚æˆ‘å€‘è§€å¯Ÿåˆ°æ‚¨å°ç‰¹å®šç”¢æ¥­æœ‰èˆˆè¶£ï¼Œæƒ³é‚€è«‹æ‚¨åƒåŠ ä¸€å ´**å…è²»**çš„ç”¢æ¥­åˆ†æè¬›åº§ï¼Œé€™ä¸æ˜¯æ¨éŠ·ï¼Œåªæ˜¯åˆ†äº«ç ”ç©¶ã€‚', risk: 10, options: [
                { text: 'å¤ªå¥½äº†ï¼Œæœ‰ä»€éº¼é™åˆ¶å—ï¼Ÿ', nextStage: 'follow_up_1_info', riskChange: 5 },
                { text: 'æˆ‘è¨å­æ¨éŠ·ï¼Œæˆ‘æ²’èˆˆè¶£ã€‚', nextStage: 'end_true_miss_invest', riskChange: 0 },
                { text: 'æ˜¯è©é¨™å—ï¼Ÿä½ æ€éº¼çŸ¥é“æˆ‘å°é€™å€‹ç”¢æ¥­æœ‰èˆˆè¶£ï¼Ÿ', nextStage: 'doubt_1_true_invest', riskChange: 0 }
            ] },
            'follow_up_1_info': { speaker: 'TrueExpert', message: 'æ²’æœ‰é™åˆ¶ï¼Œä½†è¬›åº§ä¸­**ä¸æœƒ**è¦æ±‚æ‚¨ç°½ç´„æˆ–åŒ¯æ¬¾ã€‚è¬›åº§çµæŸå¾Œï¼Œæ‚¨å¯ä»¥è‡ªè¡Œæ±ºå®šæ˜¯å¦é ç´„ä¸€å°ä¸€é¡§å•ã€‚æˆ‘å€‘çš„é‡‘ç®¡æœƒè¨±å¯è­‰è™Ÿæ˜¯ A0088ã€‚', risk: 15, options: [
                { text: 'ï¼ˆæŸ¥è­‰è­‰è™Ÿï¼‰è­‰è™Ÿæ˜¯çœŸçš„ï¼å¥½ï¼Œæˆ‘å ±åè¬›åº§ã€‚', nextStage: 'end_true_success_invest', riskChange: -10 },
                { text: 'æˆ‘é‚„æ˜¯è¦ºå¾—éº»ç…©ï¼Œç®—äº†ã€‚', nextStage: 'end_true_miss_invest', riskChange: 0 } 
            ] },
            'doubt_1_true_invest': { speaker: 'TrueExpert', message: 'æˆ‘å€‘æ˜¯é€šéæ‚¨åœ¨å…¬é–‹è²¡ç¶“è«–å£‡ä¸Šçš„ç™¼è¨€è¨˜éŒ„åˆ¤æ–·çš„ã€‚æˆ‘å€‘ç†è§£æ‚¨çš„è¬¹æ…ï¼Œæˆ‘å€‘çš„é‡‘ç®¡æœƒè¨±å¯è­‰è™Ÿæ˜¯ A0088ï¼Œè«‹æ‚¨éš¨æ™‚ä¸Šé‡‘ç®¡æœƒç¶²ç«™æŸ¥è­‰ã€‚', risk: 15, options: [
                { text: 'ï¼ˆæŸ¥è­‰è­‰è™Ÿï¼‰è­‰è™Ÿæ˜¯çœŸçš„ï¼å¥½ï¼Œæˆ‘å ±åè¬›åº§ã€‚', nextStage: 'end_true_success_invest', riskChange: -10 },
                { text: 'æˆ‘æ±ºå®šä¸ç†æœƒä»»ä½•ä¸»å‹•çš„é‚€ç´„ã€‚', nextStage: 'end_true_miss_invest', riskChange: 0 } 
            ] },
            'end_true_success_invest': { result: 'safe', title: 'âœ… çœŸæƒ…çµå±€ï¼šç²å¾—åˆæ³•æŠ•è³‡è³‡è¨Šï¼', message: 'æ‚¨é€é**æŸ¥è­‰é‡‘ç®¡æœƒè­‰è™Ÿ**å’Œ**ç¢ºèªç„¡æ¨éŠ·å£“åŠ›**ï¼Œç¯©é¸å‡ºäº†ä¸€å ´åˆæ³•çš„ã€é«˜å“è³ªçš„ç”¢æ¥­è¬›åº§ã€‚', insight: 'çœŸæŠ•è³‡ç‰¹å¾µï¼š**æä¾›åˆæ³•è­‰è™Ÿä¸¦é¼“å‹µæŸ¥è­‰**ï¼Œ**ä¸è¦æ±‚å³æ™‚åŒ¯æ¬¾**ï¼Œ**ä¸æ‰¿è«¾æš´åˆ©**ã€‚', risk: 0 },
            'end_true_miss_invest': { result: 'cautious', title: 'âš ï¸ éŒ¯å¤±çµå±€ï¼šéŒ¯éå°ˆæ¥­è³‡è¨Š', message: 'æ‚¨å› éåº¦æ“”å¿ƒæ¨éŠ·æˆ–è©é¨™è€ŒéŒ¯å¤±äº†ä¸€æ¬¡ç²å–åˆæ³•ã€å°ˆæ¥­å¸‚å ´åˆ†æè³‡è¨Šçš„æ©Ÿæœƒã€‚', insight: 'åˆ¤æ–·çœŸå‡ï¼šå°ˆæ¥­çš„é‡‘èæ©Ÿæ§‹æœƒä»¥çŸ¥è­˜åˆ†äº«é–‹å ´ï¼Œä¸¦æä¾›å®˜æ–¹æŸ¥è­‰æ¸ é“ã€‚', risk: 20 },
        };

        // --- åŠ‡æƒ…æ¨¹ 8: çœŸå¯¦æƒ…å¢ƒ (çœŸæ±‚è·æ©Ÿæœƒ) ---
        const storyTree_true_job = {
            'start': { speaker: 'TrueRecruiter', message: 'æ‚¨å¥½ï¼Œæˆ‘æ˜¯ XX ç§‘æŠ€äººè³‡å°ˆå“¡ã€‚æˆ‘å€‘å°æ‚¨çš„å±¥æ­·å¾ˆæœ‰èˆˆè¶£ï¼Œæƒ³é‚€è«‹æ‚¨åƒåŠ ç·šä¸Šé¢è©¦ã€‚éŒ„å–å¾Œï¼Œæˆ‘å€‘éœ€è¦æ‚¨çš„éŠ€è¡Œå¸³è™Ÿä»¥ä¾›è–ªè³‡è½‰å¸³ã€‚', risk: 10, options: [
                { text: 'å¥½ï¼Œæˆ‘ä»€éº¼æ™‚å€™å¯ä»¥é¢è©¦ï¼Ÿ', nextStage: 'follow_up_1_interview', riskChange: 5 },
                { text: 'è«‹å•ä½ å€‘æ˜¯å“ªå®¶å…¬å¸ï¼Ÿå¯ä»¥æä¾›çµ±ä¸€ç·¨è™Ÿå—ï¼Ÿ', nextStage: 'doubt_1_true_job', riskChange: 0 },
                { text: 'æˆ‘å°ç·šä¸Šè·ä½å¾ˆè­¦æƒ•ï¼Œæˆ‘ç¾åœ¨æ‹’çµ•ã€‚', nextStage: 'end_true_miss_job', riskChange: 0 }
            ] },
            'follow_up_1_interview': { speaker: 'TrueRecruiter', message: 'é¢è©¦å¾Œå¦‚æœéŒ„å–ï¼Œæˆ‘å€‘éœ€è¦æ‚¨æä¾›**è–ªè½‰å¸³è™Ÿ**ï¼ˆåƒ…å¸³è™Ÿï¼Œéå¯†ç¢¼æˆ–å¡ç‰‡ï¼‰ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œè«‹æ‚¨å…ˆæº–å‚™å¥½æ‚¨çš„**å€‹äººç°¡æ­·**å’Œ**èº«åˆ†è­‰ä»¶å½±æœ¬**ç”¨æ–¼åˆæ­¥èƒŒæ™¯æŸ¥æ ¸ã€‚', risk: 15, options: [
                { text: 'æä¾›èº«åˆ†è­‰å½±æœ¬åšèƒŒæ™¯æŸ¥æ ¸ï¼Œé€™æ˜¯æ­£å¸¸çš„å—ï¼Ÿ', nextStage: 'doubt_2_true_job', riskChange: 5 },
                { text: 'æˆ‘å·²ç¶“æº–å‚™å¥½ï¼Œä½•æ™‚å¯ä»¥é–‹å§‹é¢è©¦ï¼Ÿ', nextStage: 'end_true_success_job', riskChange: -5 }
            ] },
            'doubt_1_true_job': { speaker: 'TrueRecruiter', message: 'æˆ‘å€‘çš„çµ±ä¸€ç·¨è™Ÿæ˜¯ Z99887766ã€‚èƒŒæ™¯æŸ¥æ ¸éœ€è¦èº«åˆ†è­‰å½±æœ¬æ˜¯æ¨™æº–ç¨‹åºï¼Œä½†**çµ•ä¸æœƒè¦æ±‚æä¾›é‡‘èå¡ã€å­˜æ‘ºæˆ–å¯†ç¢¼**ã€‚æ‚¨éš¨æ™‚å¯ä»¥åˆ°å‹å‹•éƒ¨ç¶²ç«™æŸ¥è­‰æˆ‘å€‘çš„çµ±ä¸€ç·¨ä¸€è™Ÿã€‚', risk: 10, options: [
                { text: 'ï¼ˆæŸ¥è­‰çµ±ç·¨ï¼‰çµ±ç·¨æ˜¯çœŸçš„ï¼Œæˆ‘æ¥å—é€™å€‹ç¨‹åºã€‚', nextStage: 'end_true_success_job', riskChange: -10 },
                { text: 'æˆ‘æ±ºå®šä¸ç†æœƒä»»ä½•ä¸»å‹•çš„é‚€ç´„ã€‚', nextStage: 'end_true_miss_job', riskChange: 0 }
            ] },
            'doubt_2_true_job': { speaker: 'TrueRecruiter', message: 'æ˜¯çš„ï¼Œé€™æ˜¯ç‚ºäº†ç¢ºä¿æ‚¨æ˜¯æœ¬äººï¼Œæˆ‘å€‘éœ€è¦å½±æœ¬é€²è¡Œæ ¸å°ã€‚ä½†è«‹æ”¾å¿ƒï¼Œæ‰€æœ‰é‡‘èè³‡è¨Šéƒ½å°‡åœ¨éŒ„å–å¾Œç•¶é¢è™•ç†ã€‚æˆ‘å€‘å …æŒä¸è¦æ±‚é‡‘èå¡ã€‚', risk: 15, options: [
                { text: 'æˆ‘æ¥å—ï¼Œé€™ç¬¦åˆè¦ç¯„ã€‚', nextStage: 'end_true_success_job', riskChange: -15 },
                { text: 'æˆ‘æ±ºå®šä¸ç†æœƒä»»ä½•éœ€è¦èº«åˆ†è­‰ä»¶çš„ç·šä¸Šæ±‚è·ã€‚', nextStage: 'end_true_miss_job', riskChange: 0 }
            ] },
            'end_true_success_job': { result: 'safe', title: 'âœ… çœŸæƒ…çµå±€ï¼šæ‰¾åˆ°é«˜è–ªè·ä½ï¼', message: 'æ‚¨é€šéäº†èƒŒæ™¯æŸ¥æ ¸ï¼Œä¸¦ç¢ºä¿äº†æ‚¨çš„é‡‘èå¡è³‡è¨Šå®‰å…¨ã€‚æ‚¨æˆåŠŸæ‰¾åˆ°äº†ä¸€ä»½åˆæ³•çš„é«˜è–ªå·¥ä½œã€‚', insight: 'çœŸæ±‚è·ç‰¹å¾µï¼š**å¯æŸ¥è­‰çš„çµ±ä¸€ç·¨è™Ÿ**ï¼Œ**åªè¦æ±‚è–ªè½‰å¸³è™Ÿï¼ˆéå¯†ç¢¼/å¡ç‰‡ï¼‰**ï¼Œè¦æ±‚è­‰ä»¶å½±æœ¬æ˜¯åˆç†çš„èƒŒæ™¯æŸ¥æ ¸ã€‚', risk: 0 },
            'end_true_miss_job': { result: 'cautious', title: 'âš ï¸ éŒ¯å¤±çµå±€ï¼šéŒ¯éé«˜è–ªæ©Ÿæœƒ', message: 'æ‚¨å› éåº¦è­¦æƒ•è€Œæ‹’çµ•äº†æä¾›åŸºæœ¬èƒŒæ™¯æŸ¥æ ¸è³‡æ–™ï¼ŒéŒ¯å¤±äº†ä¸€æ¬¡åˆæ³•çš„é«˜è–ªé ç«¯å·¥ä½œæ©Ÿæœƒã€‚', insight: 'åˆ¤æ–·çœŸå‡ï¼šæ­£è¦æ±‚è·æœƒè¦æ±‚èº«åˆ†æŸ¥æ ¸ï¼Œä½†çµ•ä¸ç¢°æ‚¨çš„é‡‘èå¡ã€å­˜æ‘ºå’Œå¯†ç¢¼ã€‚', risk: 20 },
        };
        
        // --- åŠ‡æƒ…æ¨¹ 9: å°ˆæ¥­è¦–è§’ (165 è­¦å“¡ - å‡å ±æ¡ˆæƒ…å¢ƒ) ---
        const storyTree_police = { 
            'start': { speaker: 'AI', message: 'ï¼ˆé›»è©±éˆ´éŸ¿ï¼‰... 165 å°ˆç·šæ‚¨å¥½ï¼Œè«‹å•æœ‰ä»€éº¼èƒ½å”åŠ©æ‚¨ï¼Ÿ', risk: 0, options: [
                { text: 'ï¼ˆæ¥è½é›»è©±ï¼‰', nextStage: 'citizen_call_1', riskChange: 0 },
            ] },
            'citizen_call_1': { speaker: 'Citizen', message: 'ï¼ˆèªæ°£æ¥µåº¦ææ…Œï¼‰æ•‘å‘½å•Šï¼æˆ‘å‰›æ¥åˆ°éƒµå±€é›»è©±ï¼Œèªªæˆ‘é‡è¤‡é ˜æ™®ç™¼é‡‘ï¼ä»–å€‘èªªæˆ‘å¸³æˆ¶æœ‰å•é¡Œï¼Œè¦è½‰æ¥è­¦å¯Ÿï¼Œæˆ‘æœƒä¸æœƒè¢«æŠ“èµ°ï¼Ÿ', risk: 30, options: [
                { text: 'ã€Œæ‚¨å…ˆå†·éœï¼Œè«‹æä¾›å°æ–¹é›»è©±è™Ÿç¢¼ã€‚ã€', nextStage: 'calm_down_1', riskChange: -10 },
                { text: 'ã€Œé‚£æ˜¯è©é¨™ï¼Œè«‹ç«‹åˆ»æ›æ–·ã€‚ã€', nextStage: 'too_fast', riskChange: 10 },
                { text: 'ã€Œæ‚¨æœ‰æ“ä½œ ATM äº†å—ï¼Ÿã€', nextStage: 'check_action', riskChange: 5 }
            ] },
            'too_fast': { speaker: 'Citizen', message: 'ï¼ˆæ›´æ…Œå¼µï¼‰ä½ æ€éº¼çŸ¥é“æ˜¯è©é¨™ï¼Ÿå°æ–¹æœ‰æˆ‘çš„èº«åˆ†è­‰è™Ÿï¼ä½ æ˜¯ä¸æ˜¯è·Ÿä»–å€‘ä¸€å¤¥çš„ï¼Ÿæˆ‘ä¸æ•¢ç›¸ä¿¡ä½ ï¼', risk: 50, options: [
                { text: 'ã€Œç›¸ä¿¡æˆ‘ï¼Œé€™æ˜¯æ¨™æº–SOPã€‚è«‹æ‚¨å†·éœï¼Œå…¬å‹™æ©Ÿé—œä¸æœƒè½‰æ¥é›»è©±ã€‚ã€', nextStage: 'calm_down_1', riskChange: -20 },
            ] },
            'check_action': { speaker: 'Citizen', message: 'é‚„æ²’æœ‰ï¼ä»–å«æˆ‘ç­‰ä¸€ä¸‹è¦å» ATM... æˆ‘çœŸçš„è¦é€€éŒ¢å—ï¼Ÿ', risk: 60, options: [
                { text: 'ã€Œåƒè¬ä¸è¦å»ï¼é‚£æ˜¯è©é¨™ï¼è«‹æ‚¨å†·éœï¼Œå…¬å‹™æ©Ÿé—œä¸æœƒè¦æ±‚æ“ä½œ ATMã€‚ã€', nextStage: 'calm_down_1', riskChange: -30 },
            ] },
            'calm_down_1': { speaker: 'Citizen', message: 'ï¼ˆæ·±å‘¼å¸ï¼‰å¥½... ä»–å€‘é‚„èªªï¼Œé€™æ˜¯ã€ŒåµæŸ¥ä¸å…¬é–‹ã€ï¼Œæˆ‘ä¸èƒ½è·Ÿä»»ä½•äººè¬›... æˆ‘çœŸçš„å¥½æ€•...', risk: 40, options: [
                { text: 'ã€Œé€™å°±æ˜¯é—œéµç ´ç¶»ã€‚è½åˆ°ã€åµæŸ¥ä¸å…¬é–‹ã€ã€ã€è½‰æ¥è­¦å¯Ÿã€ï¼Œ100% æ˜¯è©é¨™ã€‚ã€', nextStage: 'give_advice', riskChange: -10 },
                { text: 'ã€Œé‚£æ‚¨çš„å°å­©æˆ–å®¶äººçŸ¥é“å—ï¼Ÿã€', nextStage: 'check_family', riskChange: 0 }
            ] },
            'check_family': { speaker: 'Citizen', message: 'æˆ‘ä¸æ•¢è¬›... ä»–å€‘èªªæˆ‘è¬›äº†æœƒè¢«é€šç·... ', risk: 50, options: [
                { text: 'ã€Œä»–å€‘åœ¨æåš‡æ‚¨ï¼é€™å°±æ˜¯é—œéµç ´ç¶»ã€‚è½åˆ°ã€åµæŸ¥ä¸å…¬é–‹ã€å°±æ˜¯è©é¨™ã€‚ã€', nextStage: 'give_advice', riskChange: -20 }
            ] },
            'give_advice': { speaker: 'AI', message: 'æ‚¨æˆåŠŸå®‰æ’«äº†æ°‘çœ¾ï¼Œä¸¦æŒ‡å‡ºäº†é—œéµç ´ç¶»ã€‚æ‚¨å»ºè­°çš„ä¸‹ä¸€æ­¥æ˜¯ï¼Ÿ', risk: 10, options: [
                { text: 'ã€Œè«‹æ‚¨ç«‹åˆ»æ›æ–·å°æ–¹é›»è©±ï¼Œä¸è¦å†æ¥è½ã€‚ä¸¦æ’¥æ‰“ 1988 æŸ¥è­‰ã€‚ã€', nextStage: 'end_safe', riskChange: -10 },
                { text: 'ã€Œè«‹æ‚¨ç¹¼çºŒè·Ÿå°æ–¹èŠï¼Œå‡è£é…åˆï¼Œæˆ‘å€‘ä¾†ç›£è½ã€‚ã€', nextStage: 'end_danger', riskChange: 50 }
            ] },
            'end_safe': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²ç»“å±€ï¼šæˆåŠŸæ””é˜»ï¼', message: 'æ‚¨æˆåŠŸå®‰æ’«äº†æ°‘çœ¾ï¼Œä¸¦æä¾›äº†æ­£ç¢ºçš„SOPï¼Œæ°‘çœ¾å·²æ›æ–·è©é¨™é›»è©±ï¼Œé¿å…äº†æå¤±ã€‚', insight: '165è¦–è§’ï¼šå®‰æ’«æƒ…ç·’ã€æŒ‡å‡ºç ´ç¶»ã€æä¾›æ­£ç¢ºSOPï¼Œæ˜¯æ¥ç·šå“¡çš„ä¸‰å¤§ä»»å‹™ã€‚', risk: 0 },
            'end_danger': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šæ°‘çœ¾é™·å…¥å±éšªï¼', message: '165 ä¸æœƒè¦æ±‚æ°‘çœ¾ä»¥èº«è©¦éšªã€‚æ‚¨éŒ¯èª¤çš„å»ºè­°å¯èƒ½å°è‡´æ°‘çœ¾å› æ“ä½œä¸ç•¶ï¼Œåé­è©é¨™é›†åœ˜é–å®šæˆ–å¨è„…ã€‚', insight: '165è¦–è§’ï¼šé¦–è¦ä»»å‹™æ˜¯ä¿è­·æ°‘çœ¾å®‰å…¨ï¼Œè€Œéä¸»å‹•åµæŸ¥ã€‚', risk: 60 },
        };

        // --- åŠ‡æƒ…æ¨¹ 10: å°ˆæ¥­è¦–è§’ (165 è­¦å“¡ - çœŸæ±‚åŠ©) ---
        const storyTree_true_police_pro = {
            'start': { speaker: 'AI', message: 'ï¼ˆé›»è©±éˆ´éŸ¿ï¼‰... 165 å°ˆç·šæ‚¨å¥½ï¼Œè«‹å•æœ‰ä»€éº¼èƒ½å”åŠ©æ‚¨ï¼Ÿ', risk: 0, options: [
                { text: 'ï¼ˆæ¥è½é›»è©±ï¼‰', nextStage: 'citizen_call_true_1', riskChange: 0 },
            ] },
            'citizen_call_true_1': { speaker: 'ProCitizen', message: 'ï¼ˆèªæ°£ç„¦æ€¥ï¼Œä½†ç†æ™ºï¼‰æ‚¨å¥½ï¼Œæˆ‘å‰›æ¥åˆ°ä¸€é€š LINE è¨Šæ¯ï¼Œè‡ªç¨±æ˜¯æˆ‘å¤šå¹´ä¸è¦‹çš„æœ‹å‹ï¼Œèªªæ‰‹æ©Ÿå£äº†ï¼Œå•æˆ‘ã€ŒçŒœçŒœæˆ‘æ˜¯èª°ã€ä¸¦èªªæœ‰ç·Šæ€¥æƒ…æ³ï¼Œè¦å€Ÿ $2 è¬ã€‚æˆ‘å·²ç¶“ç”¨èˆŠè™Ÿç¢¼æ‰“é›»è©±ç¢ºèªï¼Œä½†ç„¡äººæ¥è½ã€‚è«‹å•æˆ‘è©²æ€éº¼è¾¦ï¼Ÿ', risk: 40, options: [
                { text: 'ã€Œæ‚¨å…ˆå†·éœï¼Œæ‚¨ç›®å‰æ¡å–çš„ã€Œæ‰“èˆŠè™Ÿç¢¼ç¢ºèªã€æ˜¯æ­£ç¢ºçš„ã€‚è«‹å•æ‚¨æ˜¯å¦èƒ½è¾¨èªä»–çš„è²éŸ³æˆ–èªæ°£ï¼Ÿã€', nextStage: 'calm_down_true_1', riskChange: -10 },
                { text: 'ã€Œé‚£æ˜¯è©é¨™ï¼è«‹ä¸è¦ç†æœƒã€‚ã€', nextStage: 'too_fast_true', riskChange: 10 },
            ] },
            'too_fast_true': { speaker: 'ProCitizen', message: 'ï¼ˆå›°æƒ‘ï¼‰å¯æ˜¯ä»–æ²’æœ‰æåˆ°éŒ¢ï¼Œåªæ˜¯èªªå¾ˆæ€¥ï¼Œå«æˆ‘çŒœä»–æ˜¯èª°... å¦‚æœçœŸçš„æ˜¯ä»–æ€éº¼è¾¦ï¼Ÿ', risk: 50, options: [
                { text: 'ã€Œæˆ‘ç†è§£æ‚¨çš„æ“”æ†‚ã€‚æˆ‘å€‘å»ºè­°æ‚¨è©¢å•ä¸€å€‹åªæœ‰æ‚¨å€‘å…©äººçŸ¥é“çš„**ç§äººå•é¡Œ**é€²è¡Œäº¤å‰é©—è­‰ã€‚ã€', nextStage: 'calm_down_true_1', riskChange: -20 },
            ] },
            'calm_down_true_1': { speaker: 'ProCitizen', message: 'ä»–å·²ç¶“ä¸»å‹•å‚³äº†ä¸€æ®µèªéŸ³çµ¦æˆ‘ï¼Œä½†è²éŸ³è½èµ·ä¾†æœ‰é»æ€ªæ€ªçš„ï¼Œä½†æˆ‘ä¸å¤ªç¢ºå®šã€‚æˆ‘æ‡‰è©²ç›¸ä¿¡ä»–å—ï¼Ÿ', risk: 30, options: [
                { text: 'ã€Œè«‹ä¸è¦ç›¸ä¿¡èªéŸ³ã€‚è«‹æ‚¨å …æŒä½¿ç”¨**è¦–è¨Šé€šè©±**ï¼Œæˆ–è«‹ä»–è¯ç¹«ä»–çš„å®¶äººï¼Œç„¶å¾Œæ‚¨å‘ä»–çš„å®¶äººç¢ºèªã€‚ã€', nextStage: 'give_advice_true', riskChange: -10 },
                { text: 'ã€Œæ—¢ç„¶ä»–å‚³äº†èªéŸ³ï¼Œé‚£æ‡‰è©²æ˜¯çœŸçš„æœ‹å‹äº†ã€‚ã€', nextStage: 'end_danger_true_1', riskChange: 40 }
            ] },
            'give_advice_true': { speaker: 'AI', message: 'æ‚¨æˆåŠŸæä¾›äº†å°ˆæ¥­ä¸”å®‰å…¨çš„é©—è­‰å»ºè­°ã€‚æ‚¨çš„å»ºè­°ä¸‹ä¸€æ­¥æ˜¯ï¼Ÿ', risk: 10, options: [
                { text: 'ã€Œè«‹æ‚¨ç«‹åˆ»æ¡å–è¦–è¨Šæˆ–è¯ç¹«å®¶äººé©—è­‰ï¼Œè‹¥å°æ–¹æ‹’çµ•ï¼Œè«‹ç«‹åˆ»åˆªé™¤ LINEã€‚ã€', nextStage: 'end_safe_true_police_pro', riskChange: -10 },
                { text: 'ã€Œè«‹æ‚¨ç¹¼çºŒå˜—è©¦èˆ‡å°æ–¹æ–‡å­—æºé€šï¼Œå¥—å‡ºæ›´å¤šè³‡è¨Šã€‚ã€', nextStage: 'end_danger_true_2', riskChange: 30 }
            ] },
            'end_safe_true_police_pro': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²ç»“å±€ï¼šå°ˆæ¥­å°å¼•ï¼ŒæˆåŠŸé©—è­‰ï¼', message: 'æ‚¨æä¾›äº†æ­£ç¢ºçš„å¤šé‡é©—è­‰æ–¹æ³•ã€‚æ°‘çœ¾å·²æ‰¿è«¾æœƒæ¡å–è¦–è¨Šæˆ–è¯ç¹«å®¶äººé©—è­‰ã€‚ç„¡è«–å°æ–¹æ˜¯çœŸæ˜¯å‡ï¼Œé¢¨éšªå‡å·²é™åˆ°æœ€ä½ã€‚', insight: 'çœŸæ±‚åŠ©æƒ…å¢ƒï¼šå°ˆæ¥­è¦–è§’å¿…é ˆæä¾›**å¤šå±¤æ¬¡ã€éå–®ä¸€è­‰æ“š**çš„é©—è­‰æ–¹æ³•ã€‚', risk: 0 },
            'end_danger_true_1': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šè¼•ä¿¡èªéŸ³ï¼Œèª¤å°æ°‘çœ¾ï¼', message: 'AI èªéŸ³å’Œ Deepfake å¾ˆå®¹æ˜“å½é€ ã€‚æ‚¨éŒ¯èª¤åœ°å»ºè­°æ°‘çœ¾ç›¸ä¿¡èªéŸ³ï¼Œå¯èƒ½å°è‡´æ°‘çœ¾ç¹¼çºŒé™·å…¥è©é¨™é™·é˜±ã€‚', insight: '165è¦–è§’ï¼šçµ•ä¸ç›¸ä¿¡å–®ä¸€é©—è­‰æ–¹æ³•ã€‚', risk: 60 },
            'end_danger_true_2': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šå¼•å°æ°‘çœ¾æ·±å…¥éšªå¢ƒï¼', message: 'æ‚¨ä¸è©²è¦æ±‚æ°‘çœ¾è‡ªè¡Œå¥—è©±ã€‚é€™å¯èƒ½è®“æ°‘çœ¾æš´éœ²æ›´å¤šè³‡è¨Šï¼Œæˆ–è®“è©é¨™é›†åœ˜æ›´å¼·çƒˆåœ°åæ’²ã€‚', insight: '165è¦–è§’ï¼šä¿è­·æ°‘çœ¾å®‰å…¨å§‹çµ‚æ˜¯ç¬¬ä¸€è¦å‹™ã€‚', risk: 60 },
        };

        // --- åŠ‡æƒ…æ¨¹ 11: å°ˆæ¥­è¦–è§’ (éŠ€è¡Œå°ˆå“¡ - çœŸåŒ¯æ¬¾) ---
        const storyTree_true_banker_pro = {
            'start': { speaker: 'AI', message: 'ï¼ˆä¸€ä½å®¢æˆ¶èµ°è¿‘æ«ƒæª¯ï¼ŒåŒ¯æ¬¾å–®å¡«å¯«å®Œæ•´ï¼Œä½†çœ‹èµ·ä¾†æœ‰é»ä¸è€ç…©...ï¼‰', risk: 10, options: [
                { text: 'ï¼ˆé»é ­å¾®ç¬‘ï¼‰ã€Œæ‚¨å¥½ï¼Œè«‹å•éœ€è¦ä»€éº¼æœå‹™ï¼Ÿã€', nextStage: 'customer_request_true', riskChange: 0 },
            ] },
            'customer_request_true': { speaker: 'RealCustomer', message: 'ï¼ˆèªæ°£å …å®šï¼Œç•¥å¸¶ä¸è€ï¼‰ã€Œæˆ‘è¦åŒ¯æ¬¾ 50 è¬ï¼Œé€™æ˜¯çµ¦è»Šè¡Œè²·æ–°è»Šçš„é ­æœŸæ¬¾ã€‚è«‹å¿«ä¸€é»ï¼Œæˆ‘è¶•è‘—å»ç°½ç´„ã€‚ã€', risk: 20, options: [
                { text: 'ï¼ˆæ¨™æº–é—œæ‡·æå•ï¼‰ã€Œå¥½çš„ï¼Œè«‹å•æ‚¨èªè­˜å°æ–¹è»Šè¡Œå—ï¼Ÿæ‚¨åŒ¯é€™éº¼å¤§ç­†éŒ¢çš„ç›®çš„æ˜¯ï¼Ÿã€', nextStage: 'probing_1_ask_true', riskChange: 0 },
                { text: 'ï¼ˆç›´æ¥æ”¾è¡Œï¼‰ã€Œå¥½çš„ï¼Œè«‹ç¨ç­‰ã€‚ã€', nextStage: 'end_fail_miss_true', riskChange: 10 }
            ] },
            'probing_1_ask_true': { speaker: 'RealCustomer', message: 'ï¼ˆç•¥æœ‰æƒ±æ€’ï¼‰ã€Œæˆ‘å·²ç¶“èªªäº†ï¼Œæ˜¯è²·æ–°è»Šçš„é ­æœŸæ¬¾ï¼æ”¶æ¬¾æ–¹æ˜¯ XX è»Šè¡Œçš„å…¬å¸å¸³æˆ¶ã€‚æˆ‘éƒ½å¡«åœ¨å–®å­ä¸Šäº†ï¼Œä½ é‚„ä¸ç›¸ä¿¡æˆ‘å—ï¼Ÿå¿«é»ï¼ã€', risk: 30, options: [
                { text: 'ï¼ˆç¢ºèªç´°ç¯€ï¼‰ã€Œå¥½çš„ï¼Œè¬è¬æ‚¨çš„è€å¿ƒã€‚è«‹å•æ‚¨æœ‰**æ›¸é¢è³¼è»Šåˆç´„**å¯ä»¥è®“æˆ‘çœ‹ä¸€ä¸‹å—ï¼Ÿé€™æ˜¯æˆ‘å€‘å…§æ§çš„è¦æ±‚ï¼Œè«‹æ‚¨è«’è§£ã€‚ã€', nextStage: 'probing_2_doc', riskChange: 0 },
                { text: 'ï¼ˆç›´æ¥æŒ‡æ§ï¼‰ã€Œæ‚¨æ˜¯ä¸æ˜¯è¢«è©é¨™äº†ï¼Ÿæˆ‘å¿…é ˆå‡çµæ‚¨çš„äº¤æ˜“ï¼ã€', nextStage: 'end_fail_angry_true', riskChange: 20 }
            ] },
            'probing_2_doc': { speaker: 'RealCustomer', message: 'ï¼ˆèªæ°£ç·©å’Œï¼‰ã€Œå¥½å§ï¼Œæˆ‘çŸ¥é“äº†...ï¼ˆå¾åŒ…è£¡æ‹¿å‡ºåˆç´„ï¼‰é€™æ˜¯åˆç´„ï¼Œä½ çœ‹ä¸€ä¸‹å§ã€‚ä½ å€‘éŠ€è¡ŒçœŸçš„ç®¡å¾ˆå¤šã€‚ã€', risk: 20, options: [
                { text: 'ï¼ˆçœ‹å®Œåˆç´„ï¼Œç¢ºèªæ”¶æ¬¾å¸³æˆ¶èˆ‡åˆç´„å…¬å¸åç¨±ä¸€è‡´ï¼‰ã€Œè¬è¬æ‚¨çš„é…åˆï¼Œæˆ‘ç¾åœ¨å¹«æ‚¨è™•ç†åŒ¯æ¬¾ã€‚ã€', nextStage: 'end_safe_true_banker_pro', riskChange: -20 },
                { text: 'ã€Œæˆ‘é‚„æ˜¯ä¸æ”¾å¿ƒï¼Œæˆ‘éœ€è¦é€šçŸ¥è­¦å¯Ÿéä¾†ã€‚ã€', nextStage: 'end_fail_angry_true', riskChange: 15 }
            ] },
            'end_safe_true_banker_pro': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²çµå±€ï¼šé«˜æ•ˆæœå‹™ï¼Œé‡å»ºä¿¡ä»»ï¼', message: 'æ‚¨é€šéè€å¿ƒå’Œå°ˆæ¥­çš„æ…‹åº¦ï¼Œåœ¨æ²’æœ‰æ¿€æ€’å®¢æˆ¶çš„æƒ…æ³ä¸‹å®Œæˆäº†åˆè¦çš„é—œæ‡·æå•å’Œè³‡æ–™æ ¸å°ã€‚å®¢æˆ¶çš„äº¤æ˜“é †åˆ©å®Œæˆï¼Œä¸¦å°éŠ€è¡Œçš„è¬¹æ…ç•™ä¸‹è‰¯å¥½å°è±¡ã€‚', insight: 'çœŸæƒ…å¢ƒåˆ¤æ–·ï¼šçœŸæ­£çš„å®¢æˆ¶å¯ä»¥æä¾›å®Œæ•´çš„ã€åˆç†çš„æ›¸é¢è­‰æ˜å’Œç´°ç¯€ï¼Œä¸”æœ€çµ‚æœƒé…åˆã€‚', risk: 0 },
            'end_fail_miss_true': { result: 'cautious', title: 'âš ï¸ éŒ¯å¤±çµå±€ï¼šåˆè¦æµç¨‹ç–å¤±', message: 'æ‚¨æœªèƒ½å®Œæˆé—œæ‡·æå•ã€‚é›–ç„¶é€™æ¬¡æ˜¯çœŸäº¤æ˜“ï¼Œä½†æ‚¨å¿½ç•¥äº†åˆè¦è¦æ±‚ï¼Œä¸€æ—¦ç™¼ç”Ÿè©é¨™ï¼ŒéŠ€è¡Œå°‡æ‰¿æ“”å…¨éƒ¨è²¬ä»»ã€‚', insight: 'éŠ€è¡Œè¦–è§’ï¼šåˆè¦æ˜¯åº•ç·šï¼Œä¸èƒ½å› å®¢æˆ¶ä¸è€ç…©è€Œçœç•¥æ­¥é©Ÿã€‚', risk: 40 },
            'end_fail_angry_true': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šæœå‹™å¤±ç•¶ï¼Œå®¢æˆ¶æŠ•è¨´ï¼', message: 'æ‚¨ç›´æ¥æŒ‡æ§å®¢æˆ¶è©é¨™ï¼Œå°è‡´å®¢æˆ¶å¼·çƒˆä¸æ»¿ä¸¦å‘ä¸»ç®¡æ©Ÿé—œæŠ•è¨´ã€‚é€™å°éŠ€è¡Œè²è­½é€ æˆé‡å¤§æå®³ï¼Œå®Œå…¨é•èƒŒäº†ã€Œé‡å»ºä¿¡ä»»ã€çš„ç›®æ¨™ã€‚', insight: 'éŠ€è¡Œè¦–è§’ï¼šåœ¨çœŸæƒ…å¢ƒä¸‹ï¼Œç›´æ¥æŒ‡æ§æ˜¯æœ€å¤§çš„æœå‹™å¤±èª¤ã€‚', risk: 100 },
        };
        // --- åŠ‡æƒ…æ¨¹ 12: å°ˆæ¥­è¦–è§’ (éŠ€è¡Œå°ˆå“¡ - å‡åŒ¯æ¬¾) ---
        const storyTree_banker = { 
            'start': { speaker: 'AI', message: 'ï¼ˆä¸€ä½å®¢æˆ¶ç¥è‰²æ…Œå¼µåœ°èµ°ä¾†ï¼Œä»–æ­£æˆ´è‘—è€³æ©Ÿè¬›é›»è©±ï¼Œçœ‹èµ·ä¾†å¾ˆç·Šå¼µ...ï¼‰', risk: 20, options: [
                { text: 'ï¼ˆé»é ­å¾®ç¬‘ï¼‰ã€Œæ‚¨å¥½ï¼Œæ­¡è¿å…‰è‡¨ï¼Œè«‹å•éœ€è¦ä»€éº¼æœå‹™ï¼Ÿã€', nextStage: 'customer_request', riskChange: 0 },
            ] },
            'customer_request': { speaker: 'Customer', message: 'ï¼ˆå°è²ï¼‰æˆ‘...æˆ‘è¦åŒ¯æ¬¾ 50 è¬ã€‚å¿«é»...æˆ‘æœ‰é»è¶•æ™‚é–“...', risk: 40, options: [
                { text: 'ï¼ˆæ¨™æº–æµç¨‹ï¼‰ã€Œå¥½çš„ï¼Œè«‹æ‚¨å¡«å¯«åŒ¯æ¬¾å–®ï¼Œä¸¦å‡ºç¤ºè­‰ä»¶ã€‚ã€', nextStage: 'probing_1_delay', riskChange: 0 },
                { text: 'ï¼ˆç›´æ¥è©¢å•ï¼‰ã€Œæ‚¨åŒ¯é€™éº¼å¤§ç­†éŒ¢ï¼Œæ˜¯åšä»€éº¼ç”¨çš„å‘¢ï¼Ÿã€', nextStage: 'probing_1_ask', riskChange: 10 }
            ] },
            'probing_1_delay': { speaker: 'Customer', message: 'ï¼ˆå®¢æˆ¶é–‹å§‹å¡«å–®ï¼Œä½†æ‰‹åœ¨æŠ–ï¼Œä¸¦å°è²å°é›»è©±èªªï¼šã€Œæ˜¯...æ˜¯...æˆ‘åœ¨è¾¦äº†...ã€ï¼‰', risk: 50, options: [
                { text: 'ï¼ˆåŸ·è¡Œé—œæ‡·æå•ï¼‰ã€Œå…ˆç”Ÿï¼Œçœ‹æ‚¨å¾ˆæ€¥ï¼Œè«‹å•é€™ç­†éŒ¢æ˜¯åŒ¯çµ¦èª°å‘¢ï¼Ÿã€', nextStage: 'probing_1_ask', riskChange: 0 }
            ] },
            'probing_1_ask': { speaker: 'Customer', message: 'ï¼ˆä¸è€ç…©ï¼‰ã€Œæ˜¯æˆ‘...æ˜¯æˆ‘å§ªå­è¦è²·æˆ¿å­ï¼ä½ å•é€™éº¼å¤šå¹¹å˜›ï¼å¿«é»å¹«æˆ‘åŒ¯ï¼ã€', risk: 60, options: [
                { text: 'ã€Œé€™æ˜¯è¦å®šï¼Œæˆ‘å€‘è¦é—œå¿ƒå®¢æˆ¶ã€‚è«‹å•æ‚¨èªè­˜å°æ–¹å—ï¼Ÿã€', nextStage: 'probing_2', riskChange: 0 },
                { text: 'ã€Œæ‚¨æ˜¯ä¸æ˜¯ç¢°åˆ°è©é¨™äº†ï¼Ÿã€', nextStage: 'too_direct', riskChange: 20 }
            ] },
            'too_direct': { speaker: 'Customer', message: 'ï¼ˆæš´æ€’ï¼‰ã€Œä½ æ‰è©é¨™ï¼æˆ‘å¥½å¿ƒå¹«æˆ‘å§ªå­ï¼Œä½ æ†‘ä»€éº¼èªªæˆ‘è©é¨™ï¼Ÿæˆ‘ä¸åŒ¯äº†ï¼æˆ‘å»åˆ¥å®¶éŠ€è¡Œï¼ã€', risk: 80, options: [
                { text: 'ï¼ˆå®¢æˆ¶é›¢é–‹ï¼Œæ””é˜»å¤±æ•—ï¼‰', nextStage: 'end_fail_angry', riskChange: 0 }
            ] },
            'probing_2': { speaker: 'Customer', message: 'ï¼ˆæ›´å°è²ï¼Œå°é›»è©±ï¼šã€Œä»–å€‘ä¸€ç›´åœ¨å•...ã€ï¼‰...ã€Œæˆ‘ç•¶ç„¶èªè­˜ï¼ä½ ä¸è¦å†å•äº†ï¼å¿«åŒ¯ï¼ã€', risk: 70, options: [
                { text: 'ã€Œå…ˆç”Ÿï¼Œæˆ‘å€‘åµæ¸¬åˆ°é€™å€‹å¸³æˆ¶æœ‰é¢¨éšª...ã€', nextStage: 'stall_1_risk', riskChange: 0 },
                { text: 'ï¼ˆæŒ‰ä¸‹è­¦éˆ´ï¼Œé€šçŸ¥è­¦æ–¹ï¼‰ã€Œå…ˆç”Ÿè«‹ç¨ç­‰ï¼Œæˆ‘å€‘ç³»çµ±æœ‰é»æ…¢...ã€', nextStage: 'stall_1_police', riskChange: 0 },
                { text: 'ï¼ˆå±ˆæœï¼‰ã€Œå¥½çš„ï¼Œæˆ‘ç«‹åˆ»å¹«æ‚¨è™•ç†...ã€', nextStage: 'end_fail_transfer', riskChange: 30 }
            ] },
            'stall_1_risk': { speaker: 'Customer', message: 'ï¼ˆ panic ï¼‰ã€Œä»€éº¼é¢¨éšªï¼Ÿæˆ‘ä¸ç®¡ï¼ä½ å¿«åŒ¯ï¼ä¸ç„¶æˆ‘æŠ•è¨´ä½ ï¼ã€', risk: 85, options: [
                { text: 'ï¼ˆæŒ‰ä¸‹è­¦éˆ´ï¼Œé€šçŸ¥è­¦æ–¹ï¼‰ã€Œå…ˆç”Ÿè«‹å†·éœï¼Œæˆ‘å€‘æ˜¯ç‚ºäº†ä¿è­·æ‚¨...ã€', nextStage: 'stall_1_police', riskChange: 0 },
                { text: 'ï¼ˆå±ˆæœï¼‰ã€ŒæŠ±æ­‰ï¼Œæˆ‘ç«‹åˆ»å¹«æ‚¨è™•ç†...ã€', nextStage: 'end_fail_transfer', riskChange: 30 }
            ] },
            'stall_1_police': { speaker: 'AI', message: 'ï¼ˆæ‚¨æˆåŠŸæ‹–å»¶äº†æ™‚é–“ï¼Œè­¦æ–¹å·²åœ¨è·¯ä¸Šã€‚å®¢æˆ¶éå¸¸ç„¦æ…®ï¼Œä½†ç„¡æ³•é›¢é–‹...ï¼‰', risk: 50, options: [
                { text: 'ï¼ˆè­¦æ–¹æŠµé”ï¼ŒæˆåŠŸæ””é˜»ï¼‰', nextStage: 'end_safe', riskChange: -50 }
            ] },
            'end_safe': { result: 'safe', title: 'ğŸŸ¢ç¶ è‰²çµå±€ï¼šè‡¨æ«ƒæ””é˜»æˆåŠŸï¼', message: 'æ‚¨é€éé—œæ‡·æå•å’Œæ‹–å»¶æˆ°è¡“ï¼ŒæˆåŠŸé˜»æ­¢äº†å®¢æˆ¶åŒ¯æ¬¾ï¼Œä¸¦ç­‰åˆ°è­¦æ–¹åˆ°å ´ï¼Œä¿ä½äº†å®¢æˆ¶çš„ 50 è¬ã€‚', insight: 'éŠ€è¡Œè¦–è§’ï¼šé¢å°ç„¦æ…®çš„å®¢æˆ¶ï¼ŒåŒç†å¿ƒå’Œã€Œæ‹–å»¶ã€æ˜¯æ””é˜»è©é¨™çš„é—œéµæŠ€å·§ã€‚', risk: 0 },
            'end_fail_angry': { result: 'cautious', title: 'ğŸŸ¡é»ƒè‰²çµå±€ï¼šæ””é˜»å¤±æ•— (å®¢æˆ¶æµå¤±)', message: 'æ‚¨å¤ªéç›´æ¥çš„æå•æ¿€æ€’äº†å®¢æˆ¶ï¼Œå®¢æˆ¶å·²é›¢é–‹ã€‚é›–ç„¶é€™æ¬¡æ²’åŒ¯å‡ºï¼Œä½†ä»–å¾ˆå¯èƒ½å»ä¸‹ä¸€å®¶éŠ€è¡Œï¼Œé¢¨éšªä¸¦æœªè§£é™¤ã€‚', insight: 'éŠ€è¡Œè¦–è§’ï¼šé—œæ‡·æå•éœ€è¦æŠ€å·§ï¼Œé¿å…ç›´æ¥æŒ‡æ§å®¢æˆ¶ã€Œè¢«è©é¨™ã€ã€‚', risk: 80 },
            'end_fail_transfer': { result: 'scam', title: 'ğŸ”´ç´…è‰²çµå±€ï¼šæ””é˜»å¤±æ•— (åŒ¯å‡º)', message: 'æ‚¨å±ˆæœæ–¼å®¢æˆ¶çš„å£“åŠ›ï¼Œå®Œæˆäº†åŒ¯æ¬¾ã€‚å®¢æˆ¶çš„ 50 è¬å·²é€²å…¥è©é¨™é›†åœ˜å¸³æˆ¶ï¼Œé€ æˆç„¡æ³•æŒ½å›çš„æå¤±ã€‚', insight: 'éŠ€è¡Œè¦–è§’ï¼šSOP çš„æœ€å¾Œä¸€é“é˜²ç·šï¼Œåœ¨æ–¼å°ˆå“¡çš„å …æŒã€‚', risk: 100 },
        };


        // --- æ•…äº‹æ¨¹ç¸½é›†åˆ (ç¢ºä¿åªå®£å‘Šä¸€æ¬¡) ---
        const STORY_TREES = {
            quiz: {}, 
            citizen: storyTree_citizen, // å‡æª¢è­¦
            friend: storyTree_friend,   // å‡è¦ªå‹
            invest: storyTree_invest,   // å‡æŠ•è³‡
            job_scam: storyTree_job_scam, // å‡æ±‚è·
            
            true_police: storyTree_true_police, // çœŸæª¢è­¦/éƒµå±€ (æ°‘çœ¾æ¨¡å¼)
            true_friend: storyTree_true_friend, // çœŸè¦ªå‹ (æ°‘çœ¾æ¨¡å¼)
            true_invest: storyTree_true_invest, // çœŸæŠ•è³‡ (æ°‘çœ¾æ¨¡å¼)
            true_job: storyTree_true_job,       // çœŸæ±‚è· (æ°‘çœ¾æ¨¡å¼)

            police: storyTree_police,   // 165 è­¦å“¡ (å‡å ±æ¡ˆ)
            true_police_pro: storyTree_true_police_pro, // 165 è­¦å“¡ (çœŸæ±‚åŠ©)
            bank: storyTree_banker,     // éŠ€è¡Œå°ˆå“¡ (å‡åŒ¯æ¬¾)
            true_banker_pro: storyTree_true_banker_pro, // éŠ€è¡Œå°ˆå“¡ (çœŸåŒ¯æ¬¾)
        };

        // --- æƒ…å¢ƒå°æ‡‰è¡¨ (ç”¨æ–¼éš¨æ©Ÿæ¨¡å¼) ---
        const SCENARIO_MAP = {
            'citizen_rand': { fake: 'citizen', true: 'true_police', name: 'æª¢è­¦æŸ¥æ ¸' },
            'friend_rand': { fake: 'friend', true: 'true_friend', name: 'è¦ªå‹æ±‚åŠ©' },
            'invest_rand': { fake: 'invest', true: 'true_invest', name: 'æŠ•è³‡ç²åˆ©' },
            'job_rand': { fake: 'job_scam', true: 'true_job', name: 'é«˜è–ªæ±‚è·' },
            
            // å°ˆæ¥­è¦–è§’éš¨æ©Ÿæ¨¡å¼
            'police_rand': { fake: 'police', true: 'true_police_pro', name: '165 å ±æ¡ˆ' },
            'bank_rand': { fake: 'bank', true: 'true_banker_pro', name: 'éŠ€è¡Œè‡¨æ«ƒ' },
        };

        // --- æ¨¡å¼åˆ‡æ›é‚è¼¯ (ç¢ºä¿åªå®£å‘Šä¸€æ¬¡) ---
        function switchMode(newMode) {
            if (newMode === 'quiz') {
                isQuizCompleted = false;
                resetGame(false); 
                return;
            }
            
            // è™•ç†éš¨æ©Ÿæ¨¡å¼åˆ‡æ›
            let finalMode = newMode;
            let scenario = SCENARIO_MAP[newMode];

            if (scenario) {
                // 50% æ©Ÿç‡é¸æ“‡çœŸæƒ…å¢ƒæˆ–å‡æƒ…å¢ƒ
                finalMode = Math.random() < 0.5 ? scenario.fake : scenario.true; 
                
                // è¨­å®šæ¨™é¡Œï¼Œè®“ç©å®¶çŸ¥é“ä»–å€‘é€²å…¥äº†å“ªå€‹æƒ…å¢ƒ
                const type = finalMode.startsWith('true') ? 'ğŸŸ¢ çœŸå¯¦' : 'ğŸ”´ è©é¨™';
                const name = scenario.name;
                
                if (newMode.includes('_rand')) {
                    headerTitle.textContent = `${newMode.includes('pro') ? 'å°ˆæ¥­' : 'æ°‘çœ¾'}è¦–è§’ï¼š${type} ${name}`;
                } else {
                     headerTitle.textContent = `${newMode.includes('pro') ? 'å°ˆæ¥­' : 'æ°‘çœ¾'}è¦–è§’ï¼š${type} ${name} (å›ºå®š)`;
                }
            } else {
                 // è™•ç†ééš¨æ©Ÿæ¨¡å¼çš„æ¨™é¡Œ (ä¾‹å¦‚ quiz, police, bank)
                 if (newMode === 'police') {
                     headerTitle.textContent = 'å°ˆæ¥­è¦–è§’ï¼šğŸ”´ 165 å‡å ±æ¡ˆ (å›ºå®š)';
                 } else if (newMode === 'bank') {
                     headerTitle.textContent = 'å°ˆæ¥­è¦–è§’ï¼šğŸ”´ éŠ€è¡Œè‡¨æ«ƒå‡åŒ¯æ¬¾ (å›ºå®š)';
                 } else {
                     headerTitle.textContent = 'æƒ…å¢ƒè¼‰å…¥ä¸­...';
                 }
            }

            currentMode = finalMode;
            currentStoryTree = STORY_TREES[finalMode];

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mode === newMode) {
                    btn.classList.add('active'); // æ¿€æ´»è¢«é»æ“Šçš„éš¨æ©ŸæŒ‰éˆ•
                }
            });
            
            // é‡ç½®éŠæˆ²ä»¥åŠ è¼‰æ–°æƒ…å¢ƒ
            if (isQuizCompleted) {
                resetGame(true);
            }
        }

        // --- å¿ƒç†æ¸¬é©—ç›¸é—œå‡½æ•¸ (ç¢ºä¿åªå®£å‘Šä¸€æ¬¡) ---
        
        // æ¸²æŸ“å¿ƒç†æ¸¬é©— UI
        function renderQuiz() {
            chatWindow.innerHTML = '';
            
            if (quizStage >= QUIZ_QUESTIONS.length) {
                renderQuizResult();
                return;
            }

            const currentQ = QUIZ_QUESTIONS[quizStage];
            
            // æ¸²æŸ“å•é¡Œ
            renderMessage('AI', `ã€ç¬¬ ${quizStage + 1} é¡Œã€‘è«‹èª å¯¦å›ç­”ä»¥ä¸‹æƒ…å¢ƒä¸­ï¼Œæ‚¨çš„ã€Œç¬¬ä¸€åæ‡‰ã€æ˜¯ï¼Ÿ`);
            renderMessage('AI', `${currentQ.q}`);
            
            optionsContainer.innerHTML = '';
            currentQ.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.classList.add(
                    'w-full', 'p-3', 'mb-2', 'bg-pink-500', 'text-white',
                    'font-semibold', 'rounded-xl', 'hover:bg-pink-600',
                    'transition', 'duration-150', 'shadow-md'
                );
                button.onclick = () => handleQuizAnswer(option.score, option.text);
                optionsContainer.appendChild(button);
            });
        }

        // è™•ç†æ¸¬é©—ç­”æ¡ˆ
        function handleQuizAnswer(score, answerText) {
            // 1. æ¸²æŸ“ç©å®¶å›ç­”
            renderMessage('Player', answerText);
            
            // 2. æ›´æ–°åˆ†æ•¸å’Œéšæ®µ
            quizScore += score;
            quizStage++;
            
            // 3. ç§»å‹•åˆ°ä¸‹ä¸€å€‹å•é¡Œæˆ–çµæœ
            setTimeout(() => {
                if (quizStage < QUIZ_QUESTIONS.length) {
                    renderQuiz();
                } else {
                    renderQuizResult();
                }
            }, 600);
        }

        // é¡¯ç¤ºæ¸¬é©—çµæœä¸¦è½‰æ›åˆ°éŠæˆ²é¸æ“‡
        function renderQuizResult() {
            isQuizCompleted = true;
            const result = getPersonality(quizScore);
            
            chatWindow.innerHTML = '';
            
            renderMessage('AI', `ã€æ¸¬é©—çµæœå‡ºçˆï¼ã€‘`);
            renderMessage('AI', `æ ¹æ“šæ‚¨çš„å›ç­”ï¼Œæ‚¨çš„ç¸½åˆ†æ˜¯ ${quizScore} åˆ† (ç¸½åˆ† 9 åˆ†ï¼Œåˆ†æ•¸è¶Šé«˜ä»£è¡¨å‚¾å‘è¼•ä¿¡/è¡å‹•)ã€‚`);
            renderMessage('AI', `${result.title}`);
            renderMessage('AI', `è¨“ç·´å»ºè­°ï¼š${result.description}`);
            
            optionsContainer.innerHTML = '';
            
            // é¡¯ç¤ºé–‹å§‹éŠæˆ²æŒ‰éˆ•
            const startButton = document.createElement('button');
            startButton.textContent = 'é–‹å§‹é€²è¡Œæ¨¡æ“¬è¨“ç·´ / é¸æ“‡ä½ çš„è§’è‰²';
            startButton.classList.add(
                'w-full', 'p-4', 'mb-2', 'bg-indigo-600', 'text-white',
                'font-bold', 'text-lg', 'rounded-xl', 'hover:bg-indigo-700',
                'transition', 'duration-200', 'shadow-lg'
            );
            startButton.onclick = () => {
                modeSelector.classList.remove('hidden'); // é¡¯ç¤ºæ¨¡å¼é¸æ“‡æŒ‰éˆ•
                // é€²å…¥éš¨æ©Ÿæª¢è­¦æƒ…å¢ƒ
                switchMode('citizen_rand'); 
            };
            optionsContainer.appendChild(startButton);
        }

        // --- æ ¸å¿ƒæ¸²æŸ“å‡½æ•¸ (ç¢ºä¿åªå®£å‘Šä¸€æ¬¡) ---

        /** æ¸²æŸ“ä¸€å‰‡èŠå¤©è¨Šæ¯ (æ–°å¢é ­åƒèˆ‡æ°£æ³¡æ¨£å¼) */
        function renderMessage(speaker, message) {
            const isAI = (speaker === 'AI' || speaker === 'Citizen' || speaker === 'Customer' || speaker === 'Friend' || speaker === 'Expert' || speaker === 'Recruiter' || speaker.startsWith('True') || speaker.startsWith('Pro') || speaker.startsWith('Real'));
            const messageElement = document.createElement('div');
            messageElement.classList.add('flex', 'items-start', 'space-x-3', 'mb-4', isAI ? 'justify-start' : 'justify-end');

            const messageContent = document.createElement('div');
            const avatarUrl = AVATARS[speaker] || AVATARS['AI'];
            
            // èŠå¤©æ°£æ³¡
            const bubble = document.createElement('div');
            bubble.classList.add('chat-bubble', isAI ? 'bg-white' : 'bg-indigo-500', isAI ? 'text-gray-800' : 'text-white', isAI ? 'shadow-md' : 'shadow-lg');
            
            // æ ¹æ“šèªªè©±è€…èª¿æ•´æ°£æ³¡åœ“è§’
            if (isAI) {
                bubble.classList.add('rounded-tr-xl', 'rounded-bl-xl', 'rounded-br-xl');
            } else {
                bubble.classList.add('rounded-tl-xl', 'rounded-bl-xl', 'rounded-br-xl');
            }

            // --- é¡è‰²åˆ¤æ–·é‚è¼¯ ---
            bubble.classList.remove('bg-white', 'text-gray-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800', 'bg-green-100', 'text-green-800', 'bg-purple-100', 'text-purple-800', 'bg-orange-100', 'text-orange-800', 'bg-blue-100', 'text-blue-800', 'bg-green-200', 'text-green-800', 'bg-purple-200', 'text-purple-800', 'bg-red-200', 'text-red-800', 'bg-gray-200');

            if(speaker === 'Citizen') { // ææ…Œæ°‘çœ¾ (165 å‡å ±æ¡ˆ)
                bubble.classList.add('bg-red-100', 'text-red-800'); 
            } else if(speaker === 'Customer') { // ç„¦æ…®å®¢æˆ¶ (éŠ€è¡Œå‡åŒ¯æ¬¾)
                bubble.classList.add('bg-yellow-100', 'text-yellow-800'); 
            } else if(speaker === 'ProCitizen') { // çœŸæƒ…å¢ƒä¸­çš„æ°‘çœ¾ (165 çœŸæ±‚åŠ©)
                bubble.classList.add('bg-blue-100', 'text-blue-800', 'font-semibold'); 
            } else if(speaker === 'RealCustomer') { // çœŸæƒ…å¢ƒä¸­çš„å®¢æˆ¶ (éŠ€è¡ŒçœŸåŒ¯æ¬¾)
                bubble.classList.add('bg-green-100', 'text-green-800', 'font-semibold'); 
            } else if(speaker === 'Friend') { // å‡è¦ªå‹
                bubble.classList.add('bg-green-100', 'text-green-800'); 
            } else if(speaker === 'Expert') { // å‡å°ˆå®¶
                bubble.classList.add('bg-purple-100', 'text-purple-800'); 
            } else if(speaker === 'Recruiter') { // å‡æ‹›å‹Ÿ
                 bubble.classList.add('bg-orange-100', 'text-orange-800'); 
            } else if(speaker === 'TruePolice' || speaker === 'TrueExpert' || speaker === 'TrueRecruiter' || speaker === 'TrueFriend') { // çœŸæƒ…å¢ƒ NPC
                 bubble.classList.add('bg-green-200', 'text-green-800', 'font-semibold'); 
            } else if(speaker === 'AI' && !isQuizCompleted) { // æ¸¬é©—è¨Šæ¯
                 bubble.classList.add('bg-green-100', 'text-green-800', 'font-semibold'); 
            } else if (speaker === 'Player') { // ç©å®¶
                bubble.classList.add('bg-indigo-500', 'text-white');
            } else { // å‡æª¢è­¦ NPC / é è¨­è©é¨™
                bubble.classList.add('bg-gray-200', 'text-gray-800'); 
            }
            // --- é¡è‰²åˆ¤æ–·é‚è¼¯ END ---

            bubble.textContent = message;

            // é ­åƒå…ƒç´ 
            const avatar = document.createElement('img');
            avatar.src = avatarUrl;
            avatar.alt = speaker;
            avatar.classList.add('avatar', 'w-10', 'h-10', 'flex-shrink-0', 'shadow');
            
            if (isAI) {
                // NPC/AI åœ¨å·¦å´
                messageElement.appendChild(avatar);
                messageElement.appendChild(bubble);
            } else {
                // Player åœ¨å³å´
                messageElement.classList.add('pl-12'); // ç¢ºä¿å³å´æ°£æ³¡ä¸æœƒé é‚Š
                messageElement.appendChild(bubble);
                messageElement.appendChild(avatar);
                messageElement.classList.remove('space-x-3');
                messageElement.classList.add('space-x-reverse', 'space-x-3');
            }

            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        /** æ¸²æŸ“ç©å®¶å¯é¸çš„é¸é …æŒ‰éˆ• */
        function renderOptions(options) {
            optionsContainer.innerHTML = ''; 
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.classList.add(
                    'w-full', 'p-3', 'mb-2', 'bg-indigo-500', 'text-white',
                    'font-semibold', 'rounded-xl', 'hover:bg-indigo-600',
                    'transition', 'duration-150', 'shadow-md'
                );
                button.onclick = () => handleOptionClick(option);
                optionsContainer.appendChild(button);
            });
        }

        /** æ›´æ–°é¢¨éšªæŒ‡æ•¸é¡¯ç¤º (æœªä½¿ç”¨ï¼Œä½†ä¿ç•™) */
        function updateRiskScore(change) {
            riskScore = Math.min(100, Math.max(0, riskScore + change)); 
        }

        /** è™•ç†ç©å®¶é»æ“Šé¸é … (åƒ…åœ¨éŠæˆ²æ¨¡å¼ä¸‹ä½¿ç”¨) */
        function handleOptionClick(option) {
            // 1. æ¸²æŸ“ç©å®¶å›è¦† (ç©å®¶åœ¨æ‰€æœ‰æ¨¡å¼ä¸­éƒ½å« 'Player')
            renderMessage('Player', option.text);

            // 2. æ›´æ–°é¢¨éšªåˆ†æ•¸
            updateRiskScore(option.riskChange);

            // 3. æ¨é€²åŠ‡æƒ…
            currentStage = option.nextStage;
            const nextNode = currentStoryTree[currentStage];

            if (nextNode.result) {
                endGame(nextNode);
            } else {
                // æ¸²æŸ“ AI/NPC å›è¦†ä¸¦å‘ˆç¾ä¸‹ä¸€çµ„é¸é …
                setTimeout(() => {
                    // æ ¹æ“šæ¨¡å¼ç¢ºå®š NPC èªªè©±è€…åç¨±
                    let speakerName = nextNode.speaker;
                    
                    // å°ˆæ¥­æ¨¡å¼ä¸‹çš„ NPC æ˜¯æ°‘çœ¾/å®¢æˆ¶
                    if (currentMode === 'police' && nextNode.speaker === 'AI' && currentStage !== 'start') speakerName = 'Citizen'; 
                    if (currentMode === 'bank' && nextNode.speaker === 'AI' && currentStage !== 'start') speakerName = 'Customer'; 
                    
                    // çœŸæƒ…å¢ƒä¸­çš„å°ˆæ¥­ NPC å®¢æˆ¶
                    if (currentMode === 'true_police_pro') speakerName = 'ProCitizen';
                    if (currentMode === 'true_banker_pro') speakerName = 'RealCustomer';

                    // æ°‘çœ¾æ¨¡å¼ä¸‹çš„å‡/çœŸ NPC
                    if (currentMode === 'friend') speakerName = 'Friend'; 
                    if (currentMode === 'invest') speakerName = 'Expert';
                    if (currentMode === 'job_scam') speakerName = 'Recruiter'; 

                    // çœŸå¯¦æƒ…å¢ƒæ¨¡å¼ä¸‹çš„ NPC
                    if (currentMode === 'true_police') speakerName = 'TruePolice';
                    if (currentMode === 'true_friend') speakerName = 'TrueFriend';
                    if (currentMode === 'true_invest') speakerName = 'TrueExpert';
                    if (currentMode === 'true_job') speakerName = 'TrueRecruiter';

                    renderMessage(speakerName, nextNode.message);
                    renderOptions(nextNode.options);
                }, 600); // æ¨¡æ“¬ AI/NPC å›è¦†å»¶é²
            }
        }

        /** çµæŸéŠæˆ²ä¸¦é¡¯ç¤ºçµæœ */
        function endGame(node) {
            optionsContainer.innerHTML = ''; 
            document.getElementById('result-title').textContent = node.title;
            document.getElementById('result-message').textContent = node.message;
            document.getElementById('result-insight').textContent = node.insight; 
            
            const titleElement = document.getElementById('result-title');
            titleElement.classList.remove('text-red-600', 'text-green-600', 'text-yellow-600');
            if (node.result === 'scam') {
                titleElement.classList.add('text-red-600');
            } else if (node.result === 'safe') {
                titleElement.classList.add('text-green-600');
            } else if (node.result === 'cautious') {
                titleElement.classList.add('text-yellow-600');
            }
            resultModal.classList.remove('hidden');
        }

        /** é‡è¨­éŠæˆ² (æœƒåŠ è¼‰ç•¶å‰æ¨¡å¼çš„ 'start') */
        function resetGame(keepMode = false) {
            chatWindow.innerHTML = '';
            resultModal.classList.add('hidden');
            riskScore = 0;
            updateRiskScore(0); 

            if (!isQuizCompleted || (keepMode === false && currentMode === 'quiz')) {
                // å¦‚æœæ¸¬é©—æœªå®Œæˆæˆ–æ˜ç¢ºè¦æ±‚é‡ç½®æ¸¬é©—
                quizScore = 0;
                quizStage = 0;
                isQuizCompleted = false;
                modeSelector.classList.add('hidden');
                riskIndicator.classList.add('hidden');
                headerTitle.textContent = 'AI é˜²è©ï¼šå€‹äººé˜²ç¦¦å‚¾å‘æ¸¬é©—';
                renderQuiz();
                return;
            }
            
            // éŠæˆ²æ¨¡å¼çš„å•Ÿå‹•é‚è¼¯
            modeSelector.classList.remove('hidden');
            riskIndicator.classList.remove('hidden');
            const initialNode = currentStoryTree['start'];
            currentStage = 'start';

            // æ ¹æ“šæ¨¡å¼èª¿æ•´èµ·å§‹èªæ°£ (ç¢ºä¿æ˜¯æ­£ç¢ºçš„ NPC)
            let initialSpeaker = initialNode.speaker;
            if (currentMode === 'police') initialSpeaker = 'AI'; 
            if (currentMode === 'bank') initialSpeaker = 'AI'; 
            if (currentMode === 'friend') initialSpeaker = 'Friend'; 
            if (currentMode === 'invest') initialSpeaker = 'Expert';
            if (currentMode === 'job_scam') initialSpeaker = 'Recruiter';
            if (currentMode === 'true_police') initialSpeaker = 'TruePolice';
            if (currentMode === 'true_friend') initialSpeaker = 'TrueFriend';
            if (currentMode === 'true_invest') initialSpeaker = 'TrueExpert';
            if (currentMode === 'true_job') initialSpeaker = 'TrueRecruiter';
            if (currentMode === 'true_police_pro') initialSpeaker = 'ProCitizen';
            if (currentMode === 'true_banker_pro') initialSpeaker = 'RealCustomer';

            renderMessage(initialSpeaker, initialNode.message);
            renderOptions(initialNode.options);
        }

        // å•Ÿå‹•éŠæˆ² (é»˜èªåŠ è¼‰æ°‘çœ¾è¦–è§’)
        window.onload = () => {
            // åˆå§‹ç‹€æ…‹ä¸‹ï¼ŒisQuizCompleted ç‚º falseï¼Œæœƒè‡ªå‹•è§¸ç™¼ resetGame é€²å…¥ renderQuiz
            resetGame();
        };

    </script>

</body>
</html>
